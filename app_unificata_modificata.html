<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Hub | Ghost Close & Password v26</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        /* =========================================
           CORE STYLES (INVARIATI)
           ========================================= */
        :root {
            --bg-dark: #020205;
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --neon-green: #0aff60;
            --glass-base: rgba(10, 10, 12, 0.75);
            --glass-blur: 40px;
            --mouse-x: 50%;
            --mouse-y: 50%;
            --active-color: rgba(255, 255, 255, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background-color: var(--bg-dark);
            color: #fff;
            font-family: 'Inter', sans-serif;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex; flex-direction: column;
            position: relative;
            perspective: 1200px;
        }

        /* BACKGROUND LAYERS */
        #living-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
        .deep-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at 50% 120%, #050508 0%, #000000 80%); }
        .flashlight-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; background: radial-gradient(var(--spot-size, 400px) circle at var(--mouse-x) var(--mouse-y), var(--active-color), transparent 60%); mix-blend-mode: screen; opacity: 0.8; transition: background 0.3s ease; }
        .scanlines { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: repeating-linear-gradient(to bottom, transparent 0px, transparent 2px, rgba(0,0,0,0.3) 3px); pointer-events: none; z-index: 3; opacity: 0.2; }

        /* INTERACTIVE GLASS */
        .interactive-glass { position: relative; background: var(--glass-base); backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur)); border-radius: 24px; --rx: -1000px; --ry: -1000px; transition: transform 0.2s cubic-bezier(0.2, 0.8, 0.2, 1); border: 1px solid rgba(255,255,255,0.02); }
        .interactive-glass::before { content: ""; position: absolute; inset: 0; border-radius: inherit; padding: 1.5px; background: radial-gradient(350px circle at var(--rx) var(--ry), rgba(255,255,255,0.7), transparent 40%); -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none; z-index: 2; opacity: 1; }
        .interactive-glass::after { content: ""; position: absolute; inset: 0; border-radius: inherit; background: radial-gradient(400px circle at var(--rx) var(--ry), rgba(255,255,255,0.08), transparent 40%); z-index: 1; pointer-events: none; opacity: 1; }
        .interactive-glass:hover { transform: scale(1.01); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }

        /* HEADER */
        .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 25px 40px; z-index: 100; position: relative; flex-shrink: 0; transition: transform 0.3s ease; }
        .weather-wrapper { position: relative; z-index: 202; }
        .weather-widget { display: flex; align-items: center; gap: 15px; padding: 10px 25px; border-radius: 50px; cursor: pointer; }
        .weather-forecast { position: absolute; top: 120%; left: 0; width: 300px; background: rgba(5, 5, 8, 0.95); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: 0.3s; box-shadow: 0 20px 50px rgba(0,0,0,0.8); pointer-events: none; backdrop-filter: blur(20px); }
        .weather-wrapper:hover .weather-forecast { opacity: 1; visibility: visible; transform: translateY(0); pointer-events: auto; }
        .forecast-section { margin-bottom: 15px; }
        .forecast-title { color: var(--neon-blue); font-size: 0.75rem; font-weight: bold; text-transform: uppercase; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 4px; }
        .forecast-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.9rem; color: #ccc; }
        .clock-widget { text-align: right; }
        .time { font-family: 'Orbitron', sans-serif; font-size: 2.5rem; font-weight: 700; color: #fff; text-shadow: 0 0 20px rgba(255,255,255,0.3); }
        .date { font-size: 0.9rem; color: #aaa; letter-spacing: 1px; text-transform: uppercase; }

        /* HOME TILES */
        .hub-home { flex: 1; display: flex; gap: 40px; justify-content: center; align-items: center; padding: 20px; z-index: 50; position: relative; transition: opacity 0.3s ease; }
        .hub-tile { width: 350px; height: 480px; border-radius: 36px; display: flex; flex-direction: column; padding: 36px; cursor: pointer; text-decoration: none; color: white; transform-style: preserve-3d; transform: perspective(1000px); box-shadow: 0 30px 70px -10px rgba(0, 0, 0, 0.8); }
        .hub-tile:hover { transform: none; }
        .hub-tile-content { position: relative; z-index: 4; transform: translateZ(40px); pointer-events: none; display: flex; flex-direction: column; height: 100%; }
        .hub-tile-title { font-size: 2.6rem; font-weight: 700; line-height: 1.05; color: #ffffff; letter-spacing: -1.2px; text-shadow: 0 4px 12px rgba(0,0,0,0.6); margin-bottom: 20px; }
        .hub-tile-icon { flex-grow: 1; position: relative; display: flex; justify-content: center; align-items: center; padding-bottom: 10px; transform: translateZ(20px); }
        .hub-tile-glow { position: absolute; width: 140px; height: 140px; border-radius: 50%; filter: blur(60px); opacity: 0.2; top: 50%; left: 50%; transform: translate(-50%, -50%); transition: 0.5s; background: var(--tile-color); }
        .hub-tile:hover .hub-tile-glow { opacity: 0.6; transform: translate(-50%, -50%) scale(1.3); }
        .hub-tile-footer { margin-top: auto; text-align: center; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.05); color: #b0b0cc; font-size: 0.9rem; }
        svg { width: 100%; height: 200px; overflow: visible; }
        .neon-icon-glow { filter: drop-shadow(0 0 5px rgba(255,255,255,0.1)); transition: filter 0.3s; }
        .hub-tile:hover .neon-icon-glow { filter: drop-shadow(0 0 15px var(--tile-color)); }

        /* FOOTER */
        .bottom-bar { display: flex; justify-content: space-between; align-items: flex-end; padding: 30px 40px; z-index: 200; position: relative; flex-shrink: 0; transition: transform 0.3s ease; }
        .music-bar { display: flex; align-items: center; gap: 15px; padding: 15px 25px; border-radius: 20px; width: 350px; cursor: pointer; }
        .music-popup { position: absolute; bottom: 0; left: 0; width: 450px; height: 400px; background: #000; border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 0; overflow: hidden; opacity: 0; visibility: hidden; transform: translateY(20px) scale(0.95); transition: 0.3s; z-index: 9001; pointer-events: none; box-shadow: 0 30px 90px rgba(0,0,0,1); display: flex; flex-direction: column; }
        .music-wrapper:hover .music-popup, .music-wrapper.locked .music-popup { opacity: 1; visibility: visible; transform: translateY(-80px) scale(1); pointer-events: auto; }
        .video-container { flex-grow: 1; width: 100%; background: #000; margin: 0; border: none; border-radius: 0; position: relative; }
        .video-container iframe { width: 100%; height: 100%; border: none; }
        .controls-area { width: 100%; background: #0a0a0e; padding: 15px; border-top: 1px solid rgba(255,255,255,0.1); flex-shrink: 0; }
        .controls-area button { background: #222; border: 1px solid #333; color: white; padding: 10px; border-radius: 8px; cursor: pointer; width: 100%; transition: 0.2s; }
        .controls-area button:hover { background: #333; border-color: #555; }
        .input-group { display: none; margin-top: 10px; gap: 8px; }
        .input-group.active { display: flex; }
        .input-group input { flex: 1; background: #111; border: 1px solid #333; color: white; padding: 8px 12px; border-radius: 6px; }
        .system-status { display: flex; gap: 10px; }
        .status-pill { display:flex; align-items:center; gap:8px; color:#888; background: rgba(0,0,0,0.4); padding:8px 12px; border-radius:8px; font-size: 0.8rem; border: 1px solid #222; }
        .status-dot { width: 8px; height: 8px; background: var(--neon-green); border-radius: 50%; box-shadow: 0 0 5px var(--neon-green); animation: pulseDot 2s infinite; }
        @keyframes pulseDot { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* =========================================
           APP VIEW - FULLSCREEN & GHOST CLOSE
           ========================================= */
        #hub-app-view {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 9999; background: #000; display: none; flex-direction: column;
        }
        #hub-app-view.active { display: flex; animation: zoomIn 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* ZONA SENSIBILE PER MOSTRARE LA X */
        .close-trigger-zone {
            position: absolute; top: 0; left: 0; width: 150px; height: 150px;
            z-index: 10001; /* Sopra iframe */
        }
        
        /* PULSANTE X - INIZIALMENTE NASCOSTO */
        .close-app-btn {
            position: absolute; top: 25px; left: 25px;
            width: 50px; height: 50px; border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.25);
            color: #fff; display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; cursor: pointer; z-index: 10002;
            transition: all 0.4s ease;
            backdrop-filter: blur(12px);
            opacity: 0; transform: translateY(-20px); pointer-events: none; /* Non cliccabile se nascosto */
        }

        /* MOSTRA X QUANDO MOUSE SU ZONA O SU BOTTONE STESSO */
        .close-trigger-zone:hover ~ .close-app-btn,
        .close-app-btn:hover {
            opacity: 1; transform: translateY(0); pointer-events: auto;
        }

        .close-app-btn:hover { 
            background: rgba(255, 255, 255, 0.3); 
            transform: rotate(90deg) scale(1.1); 
            border-color: rgba(255, 255, 255, 0.5);
        }

        #hub-iframe { width: 100%; height: 100%; border: none; background: #111; }

        /* Animazioni Tiles */
        .place-setting-plate { opacity: 0; transform: scale(0); transform-box: fill-box; transform-origin: center; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .hub-tile[data-app-id="app-a"]:hover .place-setting-plate { opacity: 1; transform: scale(1); }
        @keyframes hologram-deploy { 0% { opacity: 0; transform: scaleY(0) scaleX(0.8); } 60% { opacity: 0.9; transform: scaleY(1.1) scaleX(1.05); } 100% { opacity: 1; transform: scaleY(1) scaleX(1); } }
        @keyframes hologram-idle { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        .hologram-anim-layer { opacity: 0; transform-origin: 0 0; transform: scaleY(0); }
        .hub-tile[data-app-id="app-a"]:hover .hologram-anim-layer { animation: hologram-deploy 0.5s ease-out forwards, hologram-idle 2s ease-in-out 0.5s infinite; }
        .hologram-text { font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 700; fill: #00f3ff; text-shadow: 0 0 5px #00f3ff; letter-spacing: 1px; }
        .hologram-border { fill: rgba(0, 243, 255, 0.1); stroke: #00f3ff; stroke-width: 1; filter: drop-shadow(0 0 4px #00f3ff); }
        .hologram-beam { fill: url(#hologramGrad); opacity: 0.6; }
        @keyframes hand-browse-sequence { 0% { transform: translate(10px, 30px) rotate(-10deg); } 30% { transform: translate(-10px, -15px) rotate(-25deg); } 40% { transform: translate(-10px, -15px) rotate(-25deg) scale(0.85); } 50% { transform: translate(-10px, -15px) rotate(-25deg) scale(1.0); } 70% { transform: translate(-10px, -15px) rotate(-25deg); } 100% { transform: translate(10px, 30px) rotate(-10deg); } }
        .hand-cursor { transform: translate(10px, 30px) rotate(-10deg); transform-origin: center; transition: transform 0.3s; }
        .hub-tile:hover .hand-cursor { animation: hand-browse-sequence 2s infinite ease-in-out; }
        @keyframes screen-tap-react { 0%, 35% { fill: #00d2d3; filter: brightness(1); } 40% { fill: #fff; filter: brightness(2); } 50% { fill: #00d2d3; filter: brightness(1); } 100% { fill: #00d2d3; filter: brightness(1); } }
        .totem-screen-fill { transition: fill 0.3s; }
        .hub-tile:hover .totem-screen-fill { animation: screen-tap-react 2s infinite ease-in-out; }
        @keyframes steam-rise { 0% { opacity: 0; transform: translateY(0) scale(0.8); } 50% { opacity: 0.8; } 100% { opacity: 0; transform: translateY(-15px) scale(1.2); } }
        .steam-path { opacity: 0; }
        .hub-tile:hover .steam-path { animation: steam-rise 2s infinite; }
        .hub-tile:hover .steam-1 { animation-delay: 0s; } .hub-tile:hover .steam-2 { animation-delay: 0.5s; } .hub-tile:hover .steam-3 { animation-delay: 1s; }
        .clock-hand { transform-origin: center; transform-box: fill-box; }
        .hub-tile:hover .clock-hand { animation: spin 4s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Responsive */
        @media (max-width: 1200px) { .hub-home { flex-wrap: wrap; } }
        @media (max-width: 768px) { .hub-home { flex-direction: column; padding: 20px; gap: 20px; } .hub-tile { width: 100%; max-width: 400px; height: 400px; } }
    </style>
</head>
<body>

    <svg style="width:0;height:0;position:absolute;" aria-hidden="true"><defs><linearGradient id="iconGradA" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#54a0ff; stop-opacity:1" /><stop offset="100%" style="stop-color:#2e86de; stop-opacity:1" /></linearGradient><linearGradient id="iconGradB" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#00d2d3; stop-opacity:1" /><stop offset="100%" style="stop-color:#00a8a8; stop-opacity:1" /></linearGradient><linearGradient id="frameGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#a29bfe; stop-opacity:1" /><stop offset="100%" style="stop-color:#0984e3; stop-opacity:1" /></linearGradient><linearGradient id="hologramGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:rgba(0, 243, 255, 0.4); stop-opacity:1" /><stop offset="100%" style="stop-color:rgba(0, 243, 255, 0); stop-opacity:0" /></linearGradient><filter id="handGlow" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur in="SourceAlpha" stdDeviation="3" result="blur"/><feFlood flood-color="#00d2d3" result="color"/><feComposite in="color" in2="blur" operator="in" result="shadow"/><feMerge><feMergeNode in="shadow"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>
    <div class="deep-bg"></div><canvas id="living-bg"></canvas><div class="flashlight-layer"></div><div class="scanlines"></div>

    <header class="top-bar">
        <div class="weather-wrapper">
            <div class="weather-widget interactive-glass">
                <div style="font-size: 1.5rem" id="w-icon">üåç</div>
                <div style="display:flex; flex-direction:column; line-height:1.2">
                    <span style="font-weight:700" id="w-temp">--¬∞C</span>
                    <span style="font-size:0.8rem; color:#aaa" id="w-loc">Rilevamento...</span>
                </div>
            </div>
            <div class="weather-forecast"><div class="forecast-section"><div class="forecast-title">Prossime Ore</div><div id="hourly-forecast"><div class="forecast-row"><span>Caricamento...</span></div></div></div><div class="forecast-section"><div class="forecast-title">Prossimi Giorni</div><div id="daily-forecast"><div class="forecast-row"><span>...</span></div></div></div></div>
        </div>
        <div class="clock-widget"><div class="time" id="clock">00:00</div><div class="date" id="date">DATA</div></div>
    </header>

    <main class="hub-home" id="hub-home"></main>

    <!-- FULLSCREEN APP CONTAINER -->
    <section id="hub-app-view">
        <div class="close-trigger-zone"></div> <!-- Zona sensibile per far apparire la X -->
        <div class="close-app-btn" onclick="attemptClose()">‚úï</div>
        <iframe id="hub-iframe"></iframe>
    </section>

    <footer class="bottom-bar">
        <div class="music-wrapper" id="music-wrapper">
            <div class="music-bar interactive-glass"><div style="font-size:1.5rem">üéµ</div><div style="display:flex; flex-direction:column; margin-left:10px"><span style="font-weight:600" id="music-title">Lofi Girl Radio</span><span style="font-size:0.75rem; color:#aaa" id="music-author">24/7 beats</span></div></div>
            <div class="music-popup">
                <div class="video-container"><iframe id="yt-frame" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media;"></iframe></div>
                <div class="controls-area">
                    <button onclick="toggleMusicInput()">Cambia Link YouTube</button>
                    <div class="input-group" id="input-group"><input type="text" id="yt-link" placeholder="ID Video o Link..."><button onclick="processYouTubeLink()">OK</button></div>
                </div>
            </div>
        </div>
        <div class="system-status"><div class="status-pill"><div class="status-dot"></div> System Online</div></div>
    </footer>

    <!-- 
    ================================================================
    ZONA INCOLLAGGIO CODICI
    ================================================================
    -->

        <template id="app-a">
      
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sala &amp; Manager - v2.0</title>
  <style>
    :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Light Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  /* Common style patterns */
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo,
    Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  /* Spacing */
  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
    0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -1px 0 rgba(0, 0, 0, 0.03);

  /* Animation */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;

    --color-bg-1: rgba(29, 78, 216, 0.15);
    --color-bg-2: rgba(180, 83, 9, 0.15);
    --color-bg-3: rgba(21, 128, 61, 0.15);
    --color-bg-4: rgba(185, 28, 28, 0.15);
    --color-bg-5: rgba(107, 33, 168, 0.15);
    --color-bg-6: rgba(194, 65, 12, 0.15);
    --color-bg-7: rgba(190, 24, 93, 0.15);
    --color-bg-8: rgba(8, 145, 178, 0.15);

    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
      inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);

    --color-success-rgb: var(--color-teal-300-rgb);
    --color-error-rgb: var(--color-red-400-rgb);
    --color-warning-rgb: var(--color-orange-400-rgb);
    --color-info-rgb: var(--color-gray-300-rgb);
  }
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: var(--font-family-base);
  background-color: var(--color-background);
  color: var(--color-text);
  line-height: var(--line-height-normal);
  -webkit-font-smoothing: antialiased;
}

/* Header */
.header {
  background-color: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: var(--space-16) var(--space-24);
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 65px;
}

.header-title {
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-text);
}

.btn-admin {
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
  border: none;
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: background-color var(--duration-fast) var(--ease-standard);
}

.btn-admin:hover {
  background-color: var(--color-primary-hover);
}

/* Main Layout */
.main-container {
  display: flex;
  height: calc(100vh - 65px);
}

/* Sidebar */
.sidebar {
  width: 280px;
  background-color: var(--color-surface);
  border-right: 1px solid var(--color-border);
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* Sidebar Content Wrapper for scrollable part */
.sidebar-content-wrapper {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-24);
}

.sidebar-section {
  margin-bottom: var(--space-32);
}

.sidebar-section h3 {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-16);
  color: var(--color-text);
}

.staff-list {
  list-style: none;
}

.staff-item {
  padding: var(--space-12);
  background-color: var(--color-background);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-base);
  margin-bottom: var(--space-8);
  cursor: pointer; /* Clickable for selection */
  transition: all var(--duration-fast);
  border-left: 3px solid transparent;
}

.staff-item:hover {
  background-color: var(--color-secondary);
}

.staff-item.selected {
  background-color: var(--color-bg-1);
  border-color: var(--color-primary);
  border-left-color: var(--color-primary);
}

.staff-name {
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  font-size: var(--font-size-base);
}

.staff-role {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-top: var(--space-4);
}

.staff-tables-count {
    font-size: var(--font-size-xs);
    color: var(--color-primary);
    font-weight: var(--font-weight-bold);
    margin-top: var(--space-4);
}

/* Footer area for Total */
.sidebar-footer {
  padding: var(--space-24);
  border-top: 1px solid var(--color-border);
  background-color: var(--color-surface);
}

.total-incasso {
  padding: var(--space-16);
  background-color: var(--color-bg-1);
  border-radius: var(--radius-base);
  text-align: center;
}

.total-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-8);
}

.total-amount {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
}

/* Content Area */
.content {
  flex: 1;
  padding: var(--space-24);
  overflow-y: auto;
  position: relative;
}

.section-title {
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-bold);
  margin-bottom: var(--space-24);
  color: var(--color-text);
}

/* Staff Selection Overlay */
.selection-overlay {
    position: absolute;
    top: var(--space-12);
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--color-primary);
    color: var(--color-white);
    padding: var(--space-8) var(--space-24);
    border-radius: var(--radius-full);
    font-weight: var(--font-weight-medium);
    box-shadow: var(--shadow-md);
    z-index: 10;
    display: none;
    animation: slideDown 0.3s ease;
}

.selection-overlay.active {
    display: block;
}

@keyframes slideDown {
    from { transform: translate(-50%, -20px); opacity: 0; }
    to { transform: translate(-50%, 0); opacity: 1; }
}

/* Tavoli Grid */
.tavoli-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: var(--space-16);
}

.tavolo-card {
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-20);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
  text-align: center;
  position: relative;
}

.tavolo-card:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-2px);
}

/* Selection mode for tables */
.tavoli-grid.selection-mode .tavolo-card {
    border-color: var(--color-primary);
    border-style: dashed;
}
.tavoli-grid.selection-mode .tavolo-card:hover {
    background-color: var(--color-bg-1);
}

.tavolo-card.occupato {
  background-color: var(--color-bg-4);
  border-color: var(--color-error);
}

.tavolo-nome {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-8);
  color: var(--color-text);
}

.tavolo-zona {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-4);
}

.tavolo-staff-assigned {
    font-size: var(--font-size-xs);
    background-color: var(--color-secondary);
    color: var(--color-text);
    padding: 2px 8px;
    border-radius: var(--radius-full);
    display: inline-block;
    margin-bottom: var(--space-8);
    font-weight: var(--font-weight-medium);
}

.tavolo-coperti {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-12);
}

.tavolo-stato {
  display: inline-block;
  padding: var(--space-4) var(--space-12);
  border-radius: var(--radius-full);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
  text-transform: uppercase;
}

.tavolo-stato.libero {
  background-color: rgba(var(--color-success-rgb), 0.15);
  color: var(--color-success);
}

.tavolo-stato.occupato {
  background-color: rgba(var(--color-error-rgb), 0.15);
  color: var(--color-error);
}

.tavolo-totale {
  margin-top: var(--space-12);
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
}

/* Modal Backdrop */
.modal-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  opacity: 0;
  transition: opacity var(--duration-normal) var(--ease-standard);
}

.modal-backdrop.open {
  display: flex;
  opacity: 1;
}

/* Dettaglio Tavolo Modal */
.dettaglio-panel {
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  width: 90%;
  max-width: 1200px;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  transform: scale(0.9);
  transition: transform var(--duration-normal) var(--ease-standard);
}

.modal-backdrop.open .dettaglio-panel {
  transform: scale(1);
}

.dettaglio-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-24);
  border-bottom: 1px solid var(--color-border);
}

.dettaglio-title {
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-text);
}

.btn-close {
  background: none;
  border: none;
  font-size: var(--font-size-2xl);
  cursor: pointer;
  color: var(--color-text-secondary);
  padding: var(--space-8);
  line-height: 1;
  transition: color var(--duration-fast);
}

.btn-close:hover {
  color: var(--color-text);
}

.dettaglio-content {
  flex: 1;
  display: flex;
  overflow: hidden;
}

/* Comanda Section (Left) */
.comanda-section {
  width: 40%;
  padding: var(--space-24);
  border-right: 1px solid var(--color-border);
  overflow-y: auto;
}

.comanda-title {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-16);
  color: var(--color-text);
}

.comanda-group-header {
    font-size: var(--font-size-sm);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-primary);
    font-weight: var(--font-weight-bold);
    margin-top: var(--space-16);
    margin-bottom: var(--space-8);
    padding-bottom: var(--space-4);
    border-bottom: 1px solid var(--color-border);
}
.comanda-group-header:first-of-type {
    margin-top: 0;
}

.comanda-list {
  list-style: none;
}

.comanda-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-12);
  background-color: var(--color-background);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-base);
  margin-bottom: var(--space-8);
}

.comanda-item-info {
  flex: 1;
}

.comanda-item-nome {
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  margin-bottom: var(--space-4);
}

.comanda-item-qty {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.comanda-item-prezzo {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

.comanda-totale {
  margin-top: var(--space-24);
  padding: var(--space-16);
  background-color: var(--color-bg-1);
  border-radius: var(--radius-base);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.comanda-totale-label {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

.comanda-totale-amount {
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
}

.btn-chiudi-conto {
  width: 100%;
  margin-top: var(--space-16);
  padding: var(--space-12);
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
  border: none;
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: background-color var(--duration-fast);
}

.btn-chiudi-conto:hover {
  background-color: var(--color-primary-hover);
}

.comanda-empty {
  text-align: center;
  color: var(--color-text-secondary);
  padding: var(--space-32);
  font-size: var(--font-size-base);
}

/* Aggiungi Section (Right) */
.aggiungi-section {
  width: 60%;
  padding: var(--space-24);
  overflow-y: auto;
}

.aggiungi-title {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-20);
  color: var(--color-text);
}

/* Category Filters */
.category-filters {
  display: flex;
  gap: var(--space-8);
  margin-bottom: var(--space-24);
  flex-wrap: wrap;
}

.btn-category {
  padding: var(--space-8) var(--space-16);
  border: 1px solid var(--color-border);
  background-color: transparent;
  color: var(--color-text);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
}

.btn-category:hover {
  background-color: var(--color-secondary);
}

.btn-category.active {
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-color: var(--color-primary);
}

/* Piatti Grid */
.piatti-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: var(--space-16);
}

.piatto-card {
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-base);
  padding: var(--space-16);
  transition: box-shadow var(--duration-fast) var(--ease-standard);
  display: flex;
  flex-direction: column;
}

.piatto-card:hover {
  box-shadow: var(--shadow-sm);
}

.piatto-nome {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-bold);
  color: var(--color-text);
  margin-bottom: var(--space-12);
  min-height: 48px;
}

.piatto-prezzo {
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-16);
}

.piatto-actions {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  margin-top: auto;
}

.quantity-controls {
  display: flex;
  align-items: center;
  gap: var(--space-4);
  flex: 1;
}

.btn-qty {
  width: 28px;
  height: 28px;
  border: 1px solid var(--color-border);
  background-color: var(--color-surface);
  color: var(--color-text);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-semibold);
  cursor: pointer;
  transition: all var(--duration-fast);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  line-height: 1;
}

.btn-qty:hover {
  background-color: var(--color-secondary);
  border-color: var(--color-primary);
}

.quantity-display {
  min-width: 32px;
  text-align: center;
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  font-size: var(--font-size-base);
}

.btn-aggiungi {
  flex: 1;
  padding: var(--space-6) var(--space-12);
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
  border: none;
  border-radius: var(--radius-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: background-color var(--duration-fast);
  white-space: nowrap;
}

.btn-aggiungi:hover {
  background-color: var(--color-primary-hover);
}

/* Toast Notification */
.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background-color: var(--color-success);
  color: var(--color-btn-primary-text);
  padding: var(--space-12) var(--space-20);
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-lg);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  opacity: 0;
  transform: translateY(20px);
  transition: all var(--duration-normal) var(--ease-standard);
  z-index: 2000;
  pointer-events: none;
}

.toast.show {
  opacity: 1;
  transform: translateY(0);
}

/* Admin Modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 3000;
  opacity: 0;
  transition: opacity var(--duration-normal) var(--ease-standard);
}

.modal-overlay.open {
  display: flex;
  opacity: 1;
}

.modal {
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  padding: 0;
  max-width: 900px;
  width: 90%;
  max-height: 85vh;
  display: flex;
  flex-direction: column;
  transform: scale(0.9);
  transition: transform var(--duration-normal) var(--ease-standard);
}

.modal-overlay.open .modal {
  transform: scale(1);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-24);
  border-bottom: 1px solid var(--color-border);
}

.modal-title {
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-text);
}

.modal-content {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-24);
}

/* Admin Tabs */
.admin-tabs {
  display: flex;
  gap: var(--space-4);
  border-bottom: 1px solid var(--color-border);
  margin-bottom: var(--space-24);
}

.tab-button {
  padding: var(--space-12) var(--space-16);
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  color: var(--color-text-secondary);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all var(--duration-fast);
}

.tab-button:hover {
  color: var(--color-text);
}

.tab-button.active {
  color: var(--color-primary);
  border-bottom-color: var(--color-primary);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Admin Forms */
.admin-form {
  background-color: var(--color-background);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-base);
  padding: var(--space-16);
  margin-bottom: var(--space-24);
}

.form-row {
  display: flex;
  gap: var(--space-12);
  margin-bottom: var(--space-12);
  flex-wrap: wrap;
}

.form-field {
  flex: 1;
  min-width: 150px;
}

.form-field label {
  display: block;
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  margin-bottom: var(--space-6);
}

.form-field input,
.form-field select {
  width: 100%;
  padding: var(--space-8) var(--space-12);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  background-color: var(--color-surface);
  color: var(--color-text);
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
}

.form-field input:focus,
.form-field select:focus {
  outline: var(--focus-outline);
  border-color: var(--color-primary);
}

.btn-primary {
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
  border: none;
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: background-color var(--duration-fast);
}

.btn-primary:hover {
  background-color: var(--color-primary-hover);
}

.btn-secondary {
  background-color: var(--color-secondary);
  color: var(--color-text);
  border: none;
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: background-color var(--duration-fast);
}

.btn-secondary:hover {
  background-color: var(--color-secondary-hover);
}

.btn-danger {
  background-color: var(--color-error);
  color: var(--color-btn-primary-text);
  border: none;
  padding: var(--space-6) var(--space-12);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: background-color var(--duration-fast);
}

.btn-danger:hover {
  opacity: 0.9;
}

/* Admin Lists */
.admin-list {
  list-style: none;
}

.admin-list-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-12);
  background-color: var(--color-background);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-base);
  margin-bottom: var(--space-8);
}

.admin-list-item-info {
  flex: 1;
}

.admin-list-item-name {
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  margin-bottom: var(--space-4);
}

.admin-list-item-meta {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.admin-list-item-actions {
  display: flex;
  gap: var(--space-8);
}

.btn-icon {
  background: none;
  border: none;
  color: var(--color-text-secondary);
  cursor: pointer;
  padding: var(--space-4);
  font-size: var(--font-size-lg);
  transition: color var(--duration-fast);
}

.btn-icon:hover {
  color: var(--color-text);
}

.category-section {
  margin-bottom: var(--space-32);
}

.category-section h4 {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-16);
  text-transform: capitalize;
}

/* Responsive */
@media (max-width: 1024px) {
  .sidebar {
    width: 220px;
  }
  
  .dettaglio-content {
    flex-direction: column;
  }
  
  .comanda-section,
  .aggiungi-section {
    width: 100%;
    border-right: none;
    border-bottom: 1px solid var(--color-border);
  }
  
  .piatti-grid {
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  }
}

@media (max-width: 768px) {
  .main-container {
    flex-direction: column;
  }
  
  .sidebar {
    width: 100%;
    border-right: none;
    border-bottom: 1px solid var(--color-border);
    height: auto;
  }
  
  /* Sidebar reset for mobile */
  .sidebar-content-wrapper {
    height: auto;
    max-height: 200px;
  }

  .tavoli-grid {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  }
  
  .dettaglio-panel {
    width: 100%;
  }
  
  .piatti-grid {
    grid-template-columns: 1fr;
  }
}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <h1 class="header-title">Sala &amp; Manager</h1>
    <button class="btn-admin" onclick="openAdminModal()">ADMIN</button>
  </header>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <!-- Content Wrapper for scrolling -->
      <div class="sidebar-content-wrapper">
          <div class="sidebar-section">
            <h3>Staff in servizio</h3>
            <ul class="staff-list" id="staffList"></ul>
          </div>
      </div>
      
      <!-- Footer for Incasso -->
      <div class="sidebar-footer">
          <div class="total-incasso">
            <div class="total-label">Incasso Totale</div>
            <div class="total-amount" id="totalIncasso">‚Ç¨ 0,00</div>
          </div>
      </div>
    </aside>

    <!-- Content Area -->
    <main class="content">
      <!-- Overlay message for selection -->
      <div class="selection-overlay" id="selectionOverlay"></div>
      
      <h2 class="section-title">Vista Sala</h2>
      <div class="tavoli-grid" id="tavoliGrid"></div>
    </main>
  </div>

  <!-- Dettaglio Tavolo Modal -->
  <div class="modal-backdrop" id="dettaglioBackdrop" onclick="closeDettaglioBackdrop(event)">
    <div class="dettaglio-panel" id="dettaglioPanel" onclick="event.stopPropagation()">
    <div class="dettaglio-header">
      <h2 class="dettaglio-title" id="dettaglioTitle">Tavolo</h2>
      <button class="btn-close" onclick="closeDettaglio()">&times;</button>
    </div>
    <div class="dettaglio-content">
      <!-- Comanda Section -->
      <div class="comanda-section">
        <h3 class="comanda-title">Comanda in corso</h3>
        
        <!-- Comanda split: Bar vs Cucina handled in JS rendering -->
        <div id="comandaListContainer"></div>
        
        <div class="comanda-totale">
          <span class="comanda-totale-label">Totale:</span>
          <span class="comanda-totale-amount" id="comandaTotale">‚Ç¨ 0,00</span>
        </div>
        <button class="btn-chiudi-conto" onclick="chiudiConto()">Chiudi Conto</button>
      </div>

      <!-- Aggiungi Section -->
      <div class="aggiungi-section">
        <h3 class="aggiungi-title">Aggiungi a comanda</h3>
        
        <!-- Category Filters -->
        <div class="category-filters" id="categoryFilters"></div>
        
        <!-- Piatti Grid -->
        <div class="piatti-grid" id="piattiGrid"></div>
      </div>
    </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast">Piatto aggiunto!</div>

  <!-- Admin Modal -->
  <div class="modal-overlay" id="adminModal" onclick="closeAdminBackdrop(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Pannello Admin</h2>
        <button class="btn-close" onclick="closeAdminModal()">&times;</button>
      </div>
      <div class="modal-content">
        <!-- Tabs -->
        <div class="admin-tabs">
          <button class="tab-button active" onclick="switchAdminTab('menu')">Menu</button>
          <button class="tab-button" onclick="switchAdminTab('tavoli')">Tavoli</button>
          <button class="tab-button" onclick="switchAdminTab('staff')">Staff</button>
          <button class="tab-button" onclick="switchAdminTab('export')">Esporta/Importa</button>
        </div>

        <!-- Tab Menu -->
        <div id="tab-menu" class="tab-content active">
          <div class="admin-form">
            <h3 style="margin-bottom: var(--space-16); font-size: var(--font-size-lg);">Aggiungi Piatto</h3>
            <div class="form-row">
              <div class="form-field">
                <label>Categoria</label>
                <select id="newPiattoCategoria">
                  <option value="primi">Primi</option>
                  <option value="secondi">Secondi</option>
                  <option value="contorni">Contorni</option>
                  <option value="dolci">Dolci</option>
                  <option value="bevande">Bevande</option>
                </select>
              </div>
              <div class="form-field">
                <label>Nome</label>
                <input type="text" id="newPiattoNome" placeholder="Nome piatto">
              </div>
              <div class="form-field">
                <label>Prezzo (‚Ç¨)</label>
                <input type="number" id="newPiattoPrezzo" step="0.01" placeholder="0.00">
              </div>
            </div>
            <button class="btn-primary" onclick="aggiungiNuovoPiatto()">Aggiungi Piatto</button>
          </div>

          <div id="menuCategories"></div>
        </div>

        <!-- Tab Tavoli -->
        <div id="tab-tavoli" class="tab-content">
          <div class="admin-form">
            <h3 style="margin-bottom: var(--space-16); font-size: var(--font-size-lg);">Aggiungi Tavolo</h3>
            <div class="form-row">
              <div class="form-field">
                <label>Nome</label>
                <input type="text" id="newTavoloNome" placeholder="Tavolo 9">
              </div>
              <div class="form-field">
                <label>Zona</label>
                <input type="text" id="newTavoloZona" placeholder="Sala principale">
              </div>
              <div class="form-field">
                <label>Max Coperti</label>
                <input type="number" id="newTavoloMaxCoperti" min="1" placeholder="4">
              </div>
            </div>
            <button class="btn-primary" onclick="aggiungiNuovoTavolo()">Aggiungi Tavolo</button>
          </div>

          <ul class="admin-list" id="tavoliList"></ul>
        </div>

        <!-- Tab Staff -->
        <div id="tab-staff" class="tab-content">
          <div class="admin-form">
            <h3 style="margin-bottom: var(--space-16); font-size: var(--font-size-lg);">Aggiungi Staff</h3>
            <div class="form-row">
              <div class="form-field">
                <label>Nome</label>
                <input type="text" id="newStaffNome" placeholder="Nome">
              </div>
              <div class="form-field">
                <label>Ruolo</label>
                <input type="text" id="newStaffRuolo" placeholder="Cameriere">
              </div>
            </div>
            <button class="btn-primary" onclick="aggiungiNuovoStaff()">Aggiungi Staff</button>
          </div>

          <ul class="admin-list" id="staffAdminList"></ul>
        </div>

        <!-- Tab Export/Import -->
        <div id="tab-export" class="tab-content">
          <div class="admin-form">
            <h3 style="margin-bottom: var(--space-16); font-size: var(--font-size-lg);">Esporta Impostazioni</h3>
            <p style="color: var(--color-text-secondary); margin-bottom: var(--space-16); font-size: var(--font-size-sm);">Scarica tutti i dati (menu, tavoli, staff) in formato JSON.</p>
            <button class="btn-primary" onclick="esportaDati()">Esporta JSON</button>
          </div>

          <div class="admin-form">
            <h3 style="margin-bottom: var(--space-16); font-size: var(--font-size-lg);">Importa Impostazioni</h3>
            <p style="color: var(--color-text-secondary); margin-bottom: var(--space-16); font-size: var(--font-size-sm);">Carica un file JSON precedentemente esportato.</p>
            <input type="file" id="importFile" accept=".json" style="margin-bottom: var(--space-12);">
            <button class="btn-primary" onclick="importaDati()">Importa JSON</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Data
    let tavoli = [
      { id: 1, nome: "Tavolo 1", zona: "Sala principale", maxCoperti: 4, stato: "LIBERO", comanda: [], totale: 0, staffAssegnato: null },
      { id: 2, nome: "Tavolo 2", zona: "Sala principale", maxCoperti: 4, stato: "LIBERO", comanda: [], totale: 0, staffAssegnato: null },
      { id: 3, nome: "Tavolo 3", zona: "Terrazza", maxCoperti: 2, stato: "LIBERO", comanda: [], totale: 0, staffAssegnato: null },
      { id: 4, nome: "Tavolo 4", zona: "Sala principale", maxCoperti: 6, stato: "LIBERO", comanda: [], totale: 0, staffAssegnato: null },
      { id: 5, nome: "Tavolo 5", zona: "Terrazza", maxCoperti: 4, stato: "LIBERO", comanda: [], totale: 0, staffAssegnato: null },
      { id: 6, nome: "Tavolo 6", zona: "Sala principale", maxCoperti: 2, stato: "LIBERO", comanda: [], totale: 0, staffAssegnato: null },
      { id: 7, nome: "Tavolo 7", zona: "Giardino", maxCoperti: 8, stato: "LIBERO", comanda: [], totale: 0, staffAssegnato: null },
      { id: 8, nome: "Tavolo 8", zona: "Sala principale", maxCoperti: 2, stato: "LIBERO", comanda: [], totale: 0, staffAssegnato: null }
    ];

    const staff = [
      { id: 1, nome: "Marco", ruolo: "Cameriere" },
      { id: 2, nome: "Sara", ruolo: "Cameriera" },
      { id: 3, nome: "Luca", ruolo: "Responsabile Sala" },
      { id: 4, nome: "Elena", ruolo: "Cameriera" }
    ];

    const menu = {
      primi: [
        { id: 1, nome: "Spaghetti Carbonara", prezzo: 12.50, categoria: "primi" },
        { id: 2, nome: "Pappardelle al Cinghiale", prezzo: 14.00, categoria: "primi" },
        { id: 3, nome: "Risotto ai Funghi", prezzo: 13.00, categoria: "primi" },
        { id: 101, nome: "Lasagne alla Bolognese", prezzo: 11.00, categoria: "primi" },
        { id: 102, nome: "Gnocchi al Pesto", prezzo: 10.00, categoria: "primi" },
        { id: 103, nome: "Ravioli Burro e Salvia", prezzo: 12.00, categoria: "primi" }
      ],
      secondi: [
        { id: 4, nome: "Bistecca alla Fiorentina", prezzo: 28.00, categoria: "secondi" },
        { id: 5, nome: "Branzino al Forno", prezzo: 24.00, categoria: "secondi" },
        { id: 6, nome: "Pollo ai Peperoni", prezzo: 16.50, categoria: "secondi" },
        { id: 104, nome: "Filetto al Pepe Verde", prezzo: 22.00, categoria: "secondi" },
        { id: 105, nome: "Grigliata Mista", prezzo: 18.00, categoria: "secondi" },
        { id: 106, nome: "Cotoletta alla Milanese", prezzo: 14.00, categoria: "secondi" }
      ],
      contorni: [
        { id: 7, nome: "Patate al Forno", prezzo: 5.00, categoria: "contorni" },
        { id: 8, nome: "Spinaci Saltati", prezzo: 6.00, categoria: "contorni" },
        { id: 9, nome: "Insalata Mista", prezzo: 4.50, categoria: "contorni" },
        { id: 107, nome: "Verdure Grigliate", prezzo: 6.00, categoria: "contorni" },
        { id: 108, nome: "Patatine Fritte", prezzo: 4.50, categoria: "contorni" }
      ],
      dolci: [
        { id: 10, nome: "Tiramisu", prezzo: 8.00, categoria: "dolci" },
        { id: 11, nome: "Panna Cotta", prezzo: 7.50, categoria: "dolci" },
        { id: 12, nome: "Gelato Assortito", prezzo: 6.00, categoria: "dolci" },
        { id: 109, nome: "Cheesecake Frutti di Bosco", prezzo: 7.00, categoria: "dolci" },
        { id: 110, nome: "Tortino al Cioccolato", prezzo: 7.50, categoria: "dolci" },
        { id: 111, nome: "Sorbetto al Limone", prezzo: 5.00, categoria: "dolci" }
      ],
      bevande: [
        { id: 13, nome: "Acqua Naturale 0.5L", prezzo: 2.50, categoria: "bevande" },
        { id: 14, nome: "Vino Rosso Toscano", prezzo: 8.00, categoria: "bevande" },
        { id: 15, nome: "Birra 0.33L", prezzo: 5.00, categoria: "bevande" },
        { id: 16, nome: "Caff√®", prezzo: 2.00, categoria: "bevande" },
        { id: 112, nome: "Coca Cola", prezzo: 3.00, categoria: "bevande" },
        { id: 113, nome: "Aranciata", prezzo: 3.00, categoria: "bevande" },
        { id: 114, nome: "Spritz Aperol", prezzo: 6.00, categoria: "bevande" },
        { id: 115, nome: "Calice Prosecco", prezzo: 5.00, categoria: "bevande" }
      ]
    };

    let currentTavoloId = null;
    let currentCategory = 'primi';
    let quantities = {}; // Store quantities for each dish
    
    // Staff Assignment Selection Mode
    let selectionMode = false;
    let selectedStaffId = null;

    // Initialize
    renderStaffList();
    renderTavoliGrid();
    renderCategoryFilters();
    renderPiattiGrid();
    updateTotalIncasso();

    function renderStaffList() {
      const staffList = document.getElementById('staffList');
      staffList.innerHTML = staff.map(s => {
        // Calculate assigned tables
        const assignedCount = tavoli.filter(t => t.staffAssegnato === s.nome).length;
        const isSelected = selectionMode && selectedStaffId === s.id;
        
        return `
        <li class="staff-item ${isSelected ? 'selected' : ''}" onclick="toggleStaffSelection(${s.id})">
          <div class="staff-name">${s.nome}</div>
          <div class="staff-role">${s.ruolo}</div>
          <div class="staff-tables-count">Tavoli assegnati: ${assignedCount}</div>
        </li>
      `}).join('');
    }
    
    function toggleStaffSelection(id) {
        if (selectedStaffId === id && selectionMode) {
            // Deselect
            selectionMode = false;
            selectedStaffId = null;
            document.getElementById('selectionOverlay').classList.remove('active');
        } else {
            // Select
            selectionMode = true;
            selectedStaffId = id;
            const staffMember = staff.find(s => s.id === id);
            const overlay = document.getElementById('selectionOverlay');
            overlay.textContent = `Seleziona un tavolo da assegnare a ${staffMember.nome}`;
            overlay.classList.add('active');
        }
        renderStaffList();
        renderTavoliGrid(); // Update grid to show selection mode styles
    }

    function renderTavoliGrid() {
      const grid = document.getElementById('tavoliGrid');
      
      // Toggle selection mode class on grid
      if (selectionMode) {
          grid.classList.add('selection-mode');
      } else {
          grid.classList.remove('selection-mode');
      }

      grid.innerHTML = tavoli.map(t => {
        const statoClass = t.stato === 'LIBERO' ? 'libero' : 'occupato';
        const totaleDisplay = t.totale > 0 ? `<div class="tavolo-totale">‚Ç¨ ${t.totale.toFixed(2)}</div>` : '';
        const staffBadge = t.staffAssegnato 
            ? `<div class="tavolo-staff-assigned">Staff: ${t.staffAssegnato}</div>` 
            : '';

        return `
          <div class="tavolo-card ${t.stato === 'OCCUPATO' ? 'occupato' : ''}" onclick="handleTavoloClick(${t.id})">
            <div class="tavolo-nome">${t.nome}</div>
            ${staffBadge}
            <div class="tavolo-zona">${t.zona}</div>
            <div class="tavolo-coperti">Max ${t.maxCoperti} coperti</div>
            <span class="tavolo-stato ${statoClass}">${t.stato}</span>
            ${totaleDisplay}
          </div>
        `;
      }).join('');
    }

    function handleTavoloClick(tavoloId) {
        if (selectionMode && selectedStaffId) {
            // Assign table to staff
            const staffMember = staff.find(s => s.id === selectedStaffId);
            const tavolo = tavoli.find(t => t.id === tavoloId);
            
            tavolo.staffAssegnato = staffMember.nome;
            
            // Turn off selection mode
            selectionMode = false;
            selectedStaffId = null;
            document.getElementById('selectionOverlay').classList.remove('active');
            
            showToast(`Tavolo assegnato a ${staffMember.nome}`);
            renderStaffList();
            renderTavoliGrid();
        } else {
            // Normal behavior: open details
            openDettaglio(tavoloId);
        }
    }

    function openDettaglio(tavoloId) {
      currentTavoloId = tavoloId;
      const tavolo = tavoli.find(t => t.id === tavoloId);
      document.getElementById('dettaglioTitle').textContent = tavolo.nome;
      document.getElementById('dettaglioBackdrop').classList.add('open');
      currentCategory = 'primi';
      renderCategoryFilters();
      renderPiattiGrid();
      renderComanda();
    }

    function closeDettaglio() {
      document.getElementById('dettaglioBackdrop').classList.remove('open');
      currentTavoloId = null;
    }

    function closeDettaglioBackdrop(event) {
      if (event.target.id === 'dettaglioBackdrop') {
        closeDettaglio();
      }
    }

    function renderCategoryFilters() {
      const filters = document.getElementById('categoryFilters');
      const categories = [
        { key: 'primi', label: 'Primi' },
        { key: 'secondi', label: 'Secondi' },
        { key: 'contorni', label: 'Contorni' },
        { key: 'dolci', label: 'Dolci' },
        { key: 'bevande', label: 'Bevande' }
      ];
      
      filters.innerHTML = categories.map(cat => `
        <button 
          class="btn-category ${currentCategory === cat.key ? 'active' : ''}"
          onclick="selectCategory('${cat.key}')"
        >
          ${cat.label}
        </button>
      `).join('');
    }

    function selectCategory(category) {
      currentCategory = category;
      renderCategoryFilters();
      renderPiattiGrid();
    }

    function renderPiattiGrid() {
      const grid = document.getElementById('piattiGrid');
      const piatti = menu[currentCategory] || [];
      
      grid.innerHTML = piatti.map(piatto => {
        const qty = quantities[piatto.id] || 1;
        return `
          <div class="piatto-card">
            <div class="piatto-nome">${piatto.nome}</div>
            <div class="piatto-prezzo">‚Ç¨ ${piatto.prezzo.toFixed(2)}</div>
            <div class="piatto-actions">
              <div class="quantity-controls">
                <button class="btn-qty" onclick="decreaseQty(${piatto.id})">‚àí</button>
                <span class="quantity-display" id="qty-${piatto.id}">${qty}</span>
                <button class="btn-qty" onclick="increaseQty(${piatto.id})">+</button>
              </div>
              <button class="btn-aggiungi" onclick="aggiungiPiatto(${piatto.id})">Aggiungi</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function decreaseQty(piattoId) {
      const current = quantities[piattoId] || 1;
      if (current > 1) {
        quantities[piattoId] = current - 1;
        document.getElementById(`qty-${piattoId}`).textContent = quantities[piattoId];
      }
    }

    function increaseQty(piattoId) {
      const current = quantities[piattoId] || 1;
      quantities[piattoId] = current + 1;
      document.getElementById(`qty-${piattoId}`).textContent = quantities[piattoId];
    }

    function aggiungiPiatto(piattoId) {
      if (!currentTavoloId) return;
      
      const tavolo = tavoli.find(t => t.id === currentTavoloId);
      const allPiatti = [...menu.primi, ...menu.secondi, ...menu.contorni, ...menu.dolci, ...menu.bevande];
      const piatto = allPiatti.find(p => p.id === piattoId);
      
      if (!piatto) return;
      
      const qty = quantities[piattoId] || 1;
      
      // Determine Destination (Bar vs Cucina)
      const isBar = ['bevande', 'dolci'].includes(piatto.categoria);
      const destinazione = isBar ? 'bar' : 'cucina';
      
      // Add to comanda
      // Check if item exists with same ID AND same destination (though ID usually unique to item)
      const existingItem = tavolo.comanda.find(item => item.id === piattoId);
      if (existingItem) {
        existingItem.quantita += qty;
      } else {
        tavolo.comanda.push({
          id: piatto.id,
          nome: piatto.nome,
          prezzo: piatto.prezzo,
          quantita: qty,
          categoria: piatto.categoria,
          destinazione: destinazione
        });
      }
      
      // Update tavolo
      tavolo.stato = 'OCCUPATO';
      tavolo.totale = tavolo.comanda.reduce((sum, item) => sum + (item.prezzo * item.quantita), 0);
      
      // Reset quantity to 1
      quantities[piattoId] = 1;
      
      // Update UI
      renderComanda();
      renderTavoliGrid();
      updateTotalIncasso();
      renderPiattiGrid();
      showToast('Piatto aggiunto!');
    }

    function renderComanda() {
      if (!currentTavoloId) return;
      
      const tavolo = tavoli.find(t => t.id === currentTavoloId);
      const container = document.getElementById('comandaListContainer');
      const comandaTotale = document.getElementById('comandaTotale');
      
      if (tavolo.comanda.length === 0) {
        container.innerHTML = '<div class="comanda-empty">Nessun piatto in comanda</div>';
      } else {
        // Split items
        const itemsBar = tavolo.comanda.filter(i => i.destinazione === 'bar');
        const itemsCucina = tavolo.comanda.filter(i => i.destinazione === 'cucina');

        let html = '';

        // Render Bar Section
        if (itemsBar.length > 0) {
            html += `<div class="comanda-group-header">Comanda Bar</div>`;
            html += `<ul class="comanda-list">`;
            html += itemsBar.map(item => createComandaItemHTML(item)).join('');
            html += `</ul>`;
        }

        // Render Cucina Section
        if (itemsCucina.length > 0) {
            html += `<div class="comanda-group-header">Comanda Cucina</div>`;
            html += `<ul class="comanda-list">`;
            html += itemsCucina.map(item => createComandaItemHTML(item)).join('');
            html += `</ul>`;
        }

        container.innerHTML = html;
      }
      
      comandaTotale.textContent = `‚Ç¨ ${tavolo.totale.toFixed(2)}`;
    }

    function createComandaItemHTML(item) {
        return `
          <li class="comanda-item">
            <div class="comanda-item-info">
              <div class="comanda-item-nome">${item.nome}</div>
              <div class="comanda-item-qty">Quantit√†: ${item.quantita}</div>
            </div>
            <div class="comanda-item-prezzo">‚Ç¨ ${(item.prezzo * item.quantita).toFixed(2)}</div>
          </li>
        `;
    }

    function chiudiConto() {
      if (!currentTavoloId) return;
      
      const tavolo = tavoli.find(t => t.id === currentTavoloId);
      
      if (tavolo.comanda.length === 0) {
        showToast('Nessun conto da chiudere');
        return;
      }
      
      // Reset tavolo but keep assigned staff? Usually yes.
      // Only clear orders and totals.
      tavolo.comanda = [];
      tavolo.totale = 0;
      tavolo.stato = 'LIBERO';
      
      // Update UI
      renderComanda();
      renderTavoliGrid();
      updateTotalIncasso();
      showToast('Conto chiuso!');
      closeDettaglio();
    }

    function updateTotalIncasso() {
      const total = tavoli.reduce((sum, t) => sum + t.totale, 0);
      document.getElementById('totalIncasso').textContent = `‚Ç¨ ${total.toFixed(2)}`;
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2000);
    }

    // Admin Modal Functions
    let currentAdminTab = 'menu';

    function openAdminModal() {
      document.getElementById('adminModal').classList.add('open');
      renderAdminContent();
    }

    function closeAdminModal() {
      document.getElementById('adminModal').classList.remove('open');
    }

    function closeAdminBackdrop(event) {
      if (event.target.id === 'adminModal') {
        closeAdminModal();
      }
    }

    function switchAdminTab(tab) {
      currentAdminTab = tab;
      
      // Update tab buttons
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`tab-${tab}`).classList.add('active');
      
      renderAdminContent();
    }

    function renderAdminContent() {
      if (currentAdminTab === 'menu') {
        renderMenuAdmin();
      } else if (currentAdminTab === 'tavoli') {
        renderTavoliAdmin();
      } else if (currentAdminTab === 'staff') {
        renderStaffAdmin();
      }
    }

    // Menu Admin
    function renderMenuAdmin() {
      const container = document.getElementById('menuCategories');
      const categories = ['primi', 'secondi', 'contorni', 'dolci', 'bevande'];
      const categoryLabels = {
        primi: 'Primi',
        secondi: 'Secondi',
        contorni: 'Contorni',
        dolci: 'Dolci',
        bevande: 'Bevande'
      };
      
      container.innerHTML = categories.map(cat => {
        const piatti = menu[cat] || [];
        return `
          <div class="category-section">
            <h4>${categoryLabels[cat]}</h4>
            <ul class="admin-list">
              ${piatti.map(piatto => `
                <li class="admin-list-item">
                  <div class="admin-list-item-info">
                    <div class="admin-list-item-name">${piatto.nome}</div>
                    <div class="admin-list-item-meta">‚Ç¨ ${piatto.prezzo.toFixed(2)}</div>
                  </div>
                  <div class="admin-list-item-actions">
                    <button class="btn-danger" onclick="rimuoviPiatto('${cat}', ${piatto.id})">Rimuovi</button>
                  </div>
                </li>
              `).join('')}
            </ul>
          </div>
        `;
      }).join('');
    }

    function aggiungiNuovoPiatto() {
      const categoria = document.getElementById('newPiattoCategoria').value;
      const nome = document.getElementById('newPiattoNome').value.trim();
      const prezzo = parseFloat(document.getElementById('newPiattoPrezzo').value);
      
      if (!nome || isNaN(prezzo) || prezzo <= 0) {
        showToast('Compila tutti i campi correttamente');
        return;
      }
      
      const newId = Math.max(...Object.values(menu).flat().map(p => p.id)) + 1;
      
      menu[categoria].push({
        id: newId,
        nome: nome,
        prezzo: prezzo,
        categoria: categoria
      });
      
      // Reset form
      document.getElementById('newPiattoNome').value = '';
      document.getElementById('newPiattoPrezzo').value = '';
      
      renderMenuAdmin();
      showToast('Piatto aggiunto!');
    }

    function rimuoviPiatto(categoria, piattoId) {
      if (!confirm('Sei sicuro di voler rimuovere questo piatto?')) return;
      
      menu[categoria] = menu[categoria].filter(p => p.id !== piattoId);
      renderMenuAdmin();
      showToast('Piatto rimosso');
    }

    // Tavoli Admin
    function renderTavoliAdmin() {
      const container = document.getElementById('tavoliList');
      container.innerHTML = tavoli.map(tavolo => `
        <li class="admin-list-item">
          <div class="admin-list-item-info">
            <div class="admin-list-item-name">${tavolo.nome}</div>
            <div class="admin-list-item-meta">${tavolo.zona} ‚Ä¢ Max ${tavolo.maxCoperti} coperti</div>
            <div class="admin-list-item-meta" style="font-size: 0.75rem; margin-top: 2px;">
               ${tavolo.staffAssegnato ? 'Assegnato a: ' + tavolo.staffAssegnato : 'Nessun staff assegnato'}
            </div>
          </div>
          <div class="admin-list-item-actions">
            <button class="btn-danger" onclick="rimuoviTavolo(${tavolo.id})">Rimuovi</button>
          </div>
        </li>
      `).join('');
    }

    function aggiungiNuovoTavolo() {
      const nome = document.getElementById('newTavoloNome').value.trim();
      const zona = document.getElementById('newTavoloZona').value.trim();
      const maxCoperti = parseInt(document.getElementById('newTavoloMaxCoperti').value);
      
      if (!nome || !zona || isNaN(maxCoperti) || maxCoperti <= 0) {
        showToast('Compila tutti i campi correttamente');
        return;
      }
      
      const newId = Math.max(...tavoli.map(t => t.id)) + 1;
      
      tavoli.push({
        id: newId,
        nome: nome,
        zona: zona,
        maxCoperti: maxCoperti,
        stato: 'LIBERO',
        comanda: [],
        totale: 0,
        staffAssegnato: null
      });
      
      // Reset form
      document.getElementById('newTavoloNome').value = '';
      document.getElementById('newTavoloZona').value = '';
      document.getElementById('newTavoloMaxCoperti').value = '';
      
      renderTavoliAdmin();
      renderTavoliGrid();
      showToast('Tavolo aggiunto!');
    }

    function rimuoviTavolo(tavoloId) {
      if (!confirm('Sei sicuro di voler rimuovere questo tavolo?')) return;
      
      tavoli = tavoli.filter(t => t.id !== tavoloId);
      renderTavoliAdmin();
      renderTavoliGrid();
      updateTotalIncasso();
      showToast('Tavolo rimosso');
    }

    // Staff Admin
    function renderStaffAdmin() {
      const container = document.getElementById('staffAdminList');
      container.innerHTML = staff.map(s => `
        <li class="admin-list-item">
          <div class="admin-list-item-info">
            <div class="admin-list-item-name">${s.nome}</div>
            <div class="admin-list-item-meta">${s.ruolo}</div>
          </div>
          <div class="admin-list-item-actions">
            <button class="btn-danger" onclick="rimuoviStaff(${s.id})">Rimuovi</button>
          </div>
        </li>
      `).join('');
    }

    function aggiungiNuovoStaff() {
      const nome = document.getElementById('newStaffNome').value.trim();
      const ruolo = document.getElementById('newStaffRuolo').value.trim();
      
      if (!nome || !ruolo) {
        showToast('Compila tutti i campi');
        return;
      }
      
      const newId = Math.max(...staff.map(s => s.id)) + 1;
      
      staff.push({
        id: newId,
        nome: nome,
        ruolo: ruolo
      });
      
      // Reset form
      document.getElementById('newStaffNome').value = '';
      document.getElementById('newStaffRuolo').value = '';
      
      renderStaffAdmin();
      renderStaffList();
      showToast('Staff aggiunto!');
    }

    function rimuoviStaff(staffId) {
      if (!confirm('Sei sicuro di voler rimuovere questo membro dello staff?')) return;
      
      const index = staff.findIndex(s => s.id === staffId);
      if (index > -1) {
        staff.splice(index, 1);
        renderStaffAdmin();
        renderStaffList();
        showToast('Staff rimosso');
      }
    }

    // Export/Import
    function esportaDati() {
      const data = {
        menu: menu,
        tavoli: tavoli,
        staff: staff,
        exportDate: new Date().toISOString()
      };
      
      const dataStr = JSON.stringify(data, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `sala-manager-export-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      showToast('Dati esportati!');
    }

    function importaDati() {
      const fileInput = document.getElementById('importFile');
      const file = fileInput.files[0];
      
      if (!file) {
        showToast('Seleziona un file da importare');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          if (data.menu && data.tavoli && data.staff) {
            // Validate and import
            Object.assign(menu, data.menu);
            tavoli.length = 0;
            tavoli.push(...data.tavoli);
            staff.length = 0;
            staff.push(...data.staff);
            
            // Update UI
            renderStaffList();
            renderTavoliGrid();
            updateTotalIncasso();
            renderAdminContent();
            
            showToast('Dati importati con successo!');
            fileInput.value = '';
          } else {
            showToast('File JSON non valido');
          }
        } catch (error) {
          showToast('Errore nella lettura del file');
          console.error(error);
        }
      };
      reader.readAsText(file);
    }

    // ESC key to close modals
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        if (document.getElementById('dettaglioBackdrop').classList.contains('open')) {
          closeDettaglio();
        }
        if (document.getElementById('adminModal').classList.contains('open')) {
          closeAdminModal();
        }
      }
    });
  </script>
</body>
</html>

    </template>

    <template id="app-b">

<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ristorante Dashboard - Menu Digitale</title>
    <style>
        :root {
            /* Palette Colori Dark Minimal */
            --bg-body: #121212;
            --bg-sidebar: #1a1a1a;
            --bg-card: #252525;
            --bg-card-hover: #2f2f2f;
            
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #707070;

            --color-accent: #00e5ff; /* Ciano acceso per interazioni */
            --color-accent-dark: #00b8cc;
            --color-accent-alpha: rgba(0, 229, 255, 0.15);

            --status-green: #00e676; /* Disponibile/Libero */
            --status-red: #ff5252;   /* Esaurito/Occupato */

            --border-color: rgba(255, 255, 255, 0.08);
            --shadow-card: 0 4px 20px rgba(0, 0, 0, 0.4);
            --radius-card: 16px;
            --radius-btn: 50px;

            --header-height: 70px;
            --sidebar-width: 260px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* --- SCROLLBAR INVISIBILE (Cross-browser) --- */
        /* Firefox */
        * {
            scrollbar-width: none; 
        }
        /* Chrome, Edge, Safari, Opera */
        ::-webkit-scrollbar {
            width: 0;
            height: 0;
            display: none; 
        }
        /* IE/Edge Legacy */
        html, body, .main-content, .sidebar {
            -ms-overflow-style: none; 
        }

        body {
            font-family: 'Inter', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
            height: 100vh; /* Altezza fissa viewport */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Impedisce scroll sul body principale */
        }

        /* --- HEADER --- */
        .app-header {
            height: var(--header-height);
            background-color: var(--bg-sidebar);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .logo-area { display: flex; align-items: center; gap: 12px; }
        .logo-circle {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, var(--color-accent), #006064);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; color: #000; font-size: 1.2rem;
        }
        .brand-name { font-size: 1.2rem; font-weight: 600; letter-spacing: 0.5px; }

        .header-actions { display: flex; gap: 16px; align-items: center; }
        .table-status-display { 
            color: var(--text-secondary); 
            font-size: 0.9rem; 
            background: rgba(255,255,255,0.05);
            padding: 6px 12px;
            border-radius: 8px;
        }
        
        .btn-pill {
            background-color: transparent;
            border: 1px solid var(--color-accent);
            color: var(--color-accent);
            padding: 8px 20px;
            border-radius: var(--radius-btn);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-pill:hover { background-color: var(--color-accent-alpha); }

        .mobile-menu-btn {
            display: none;
            background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;
        }

        /* --- LAYOUT CONTAINER --- */
        .app-body {
            display: flex;
            margin-top: var(--header-height);
            height: calc(100vh - var(--header-height));
            width: 100%;
            overflow: hidden; /* Contenitore non scrolla, scrollano i figli */
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 20px 0 0 0; /* Padding top ma non bottom per gestione footer */
            overflow-y: auto; /* Permette scroll interno se necessario */
            flex-shrink: 0;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            height: 100%; /* Occupa tutta l'altezza disponibile */
        }

        .nav-label {
            padding: 0 24px; margin-bottom: 10px; margin-top: 10px;
            font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.2px; 
            color: var(--text-muted); font-weight: 600;
        }

        .nav-item {
            display: flex; align-items: center; gap: 12px;
            padding: 14px 24px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: 0.2s;
            cursor: pointer;
            border-left: 3px solid transparent;
            font-weight: 500;
        }

        .nav-item:hover { 
            background-color: rgba(255,255,255,0.03); 
            color: var(--text-primary); 
        }
        .nav-item.active {
            background-color: rgba(0, 229, 255, 0.05);
            color: var(--color-accent);
            border-left-color: var(--color-accent);
        }

        /* Sidebar Footer (Totale) */
        .sidebar-footer {
            margin-top: auto; /* Spinge in basso */
            padding: 24px;
            border-top: 1px solid var(--border-color);
            background-color: var(--bg-sidebar); /* Copre lo sfondo */
            position: sticky; 
            bottom: 0;
            z-index: 10;
        }
        
        .total-box {
            background: var(--bg-card);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }
        .total-label { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 4px; text-transform: uppercase; }
        .total-amount { font-size: 1.6rem; font-weight: 700; color: var(--color-accent); letter-spacing: -0.5px; }

        /* --- MAIN CONTENT --- */
        .main-content {
            flex: 1;
            /* Altezza esatta per occupare lo spazio rimanente */
            height: 100%;
            overflow-y: auto; /* Scroll verticale attivo ma invisibile */
            scroll-behavior: smooth;
            background: radial-gradient(circle at top left, #1a1a1a 0%, #121212 40%);
            position: relative;
            
            /* Padding regolato per allineamento visuale */
            padding: 30px 30px 0 30px; 
        }
        
        /* Contenitore interno per gestire lo spazio finale */
        #menu-container {
            /* Padding bottom minimo per non tagliare l'ombra dell'ultima card */
            padding-bottom: 30px; 
        }

        .section-title {
            font-size: 1.8rem; margin-bottom: 24px; font-weight: 700;
            color: var(--text-primary); display: flex; align-items: center; gap: 12px;
            text-transform: capitalize;
            scroll-margin-top: 20px;
        }
        
        section[id^="cat-"] {
            scroll-margin-top: 20px;
        }

        .section-count { 
            font-size: 0.9rem; color: var(--text-muted); font-weight: 600; 
            background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 20px; 
        }

        /* GRID SYSTEM */
        .dish-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 24px;
            /* Nessun padding bottom eccessivo qui */
        }

        /* --- DISH CARD --- */
        .dish-card {
            background-color: var(--bg-card);
            border-radius: var(--radius-card);
            border: 1px solid transparent;
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex; flex-direction: column;
            position: relative;
            box-shadow: var(--shadow-card);
            height: 100%;
        }

        .dish-card:hover {
            transform: translateY(-6px);
            border-color: rgba(255, 255, 255, 0.15);
            background-color: var(--bg-card-hover);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
        }

        .card-img-container {
            width: 100%; height: 160px;
            background-color: #2a2a2a;
            overflow: hidden;
            position: relative;
        }
        .card-img {
            width: 100%; height: 100%; object-fit: cover;
            transition: transform 0.5s ease;
            opacity: 0.9;
        }
        .dish-card:hover .card-img { transform: scale(1.08); opacity: 1; }

        .card-body { padding: 16px; display: flex; flex-direction: column; flex: 1; }
        
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; gap: 8px; }
        .dish-name { font-size: 1.1rem; font-weight: 700; color: var(--text-primary); line-height: 1.3; }
        
        /* Status LED */
        .status-dot {
            width: 8px; height: 8px; border-radius: 50%;
            background-color: var(--status-green);
            box-shadow: 0 0 8px rgba(0, 230, 118, 0.6);
            margin-top: 6px; flex-shrink: 0;
        }
        .status-dot.busy { background-color: var(--status-red); box-shadow: 0 0 8px rgba(244, 67, 54, 0.6); }

        .dish-desc {
            font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5;
            margin-bottom: 16px; flex-grow: 1;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-footer {
            display: flex; align-items: center; justify-content: space-between;
            margin-top: auto; padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        .dish-category-tag {
            font-size: 0.7rem; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px;
            color: var(--text-muted); background: rgba(255,255,255,0.05);
            padding: 4px 8px; border-radius: 4px;
        }

        .price-tag { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); }

        .btn-add {
            background-color: var(--color-accent);
            color: #000;
            border: none;
            padding: 8px 20px;
            border-radius: var(--radius-btn);
            font-weight: 600; cursor: pointer;
            font-size: 0.9rem;
            transition: 0.2s;
            box-shadow: 0 4px 12px rgba(0, 229, 255, 0.2);
        }
        .btn-add:hover { 
            background-color: var(--color-accent-dark); 
            transform: scale(1.05); 
            box-shadow: 0 6px 16px rgba(0, 229, 255, 0.3);
        }

        /* --- MOBILE BOTTOM BAR --- */
        .mobile-cart-bar {
            display: none;
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--bg-sidebar);
            padding: 12px 20px;
            border-top: 1px solid var(--border-color);
            z-index: 200;
            align-items: center; justify-content: space-between;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.6);
        }
        .mobile-total { font-size: 1.2rem; font-weight: 700; color: var(--color-accent); }
        .btn-mobile-checkout {
            background: var(--color-accent); color: #000;
            border: none; padding: 10px 24px; border-radius: var(--radius-btn);
            font-weight: 600;
        }

        /* --- MODALS --- */
        .modal-backdrop {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 300;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
            backdrop-filter: blur(4px);
        }
        .modal-backdrop.visible { opacity: 1; pointer-events: auto; }
        
        .modal-panel {
            background: var(--bg-card); width: 90%; max-width: 600px;
            border-radius: 20px; padding: 24px;
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: translateY(20px); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            max-height: 85vh; display: flex; flex-direction: column;
        }
        .modal-backdrop.visible .modal-panel { transform: translateY(0); }
        
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-shrink: 0; }
        .modal-title { font-size: 1.4rem; font-weight: 700; }
        .modal-close { background: none; border: none; color: var(--text-muted); font-size: 1.8rem; cursor: pointer; line-height: 1; }
        
        /* CART MODAL SPECIFICS */
        .cart-items-list { overflow-y: auto; padding-right: 4px; flex: 1; margin-bottom: 20px; }
        .cart-item-row {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 0; border-bottom: 1px solid var(--border-color);
        }
        .cart-thumb { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; background: #333; }
        .cart-item-details { flex: 1; }
        .cart-item-title { font-weight: 600; font-size: 1rem; margin-bottom: 4px; }
        .cart-item-meta { font-size: 0.85rem; color: var(--text-secondary); }
        
        .qty-controls { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05); padding: 4px 8px; border-radius: 20px; }
        .qty-btn { width: 24px; height: 24px; border-radius: 50%; border:none; background: rgba(255,255,255,0.1); color: white; font-weight:bold; cursor: pointer; }
        .qty-btn:hover { background: rgba(255,255,255,0.2); }
        .qty-val { font-weight: 600; min-width: 20px; text-align: center; font-size: 0.9rem; }

        .btn-remove { background: none; border: none; color: var(--status-red); margin-left: 10px; cursor: pointer; font-size: 0.9rem; }

        .cart-footer-panel { border-top: 1px solid var(--border-color); padding-top: 20px; }
        .cart-summary-row { display: flex; justify-content: space-between; margin-bottom: 16px; font-size: 1.1rem; font-weight: 700; }
        .btn-confirm { width: 100%; padding: 12px; font-size: 1.1rem; background: var(--color-accent); color: #000; border: none; border-radius: var(--radius-btn); font-weight: 700; cursor: pointer; }
        .btn-confirm:hover { background: var(--color-accent-dark); }
        
        /* Table Grid Selection */
        .table-grid-scroll { overflow-y: auto; padding: 4px; }
        .table-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 12px; }
        
        .table-select-card {
            background: rgba(255,255,255,0.05); 
            border: 2px solid transparent; 
            padding: 16px;
            border-radius: 12px; 
            text-align: center; 
            cursor: pointer;
            transition: 0.2s;
        }
        .table-select-card:hover { background: rgba(255,255,255,0.08); }
        
        .table-select-card.selected { 
            border-color: var(--color-accent); 
            background: rgba(0, 229, 255, 0.1); 
        }
        
        .table-select-card.occupied {
            border-color: var(--status-red);
            opacity: 0.7;
        }
        .table-select-card.occupied .table-name { color: var(--status-red); }
        
        .table-name { font-weight: 700; font-size: 1.1rem; margin-bottom: 4px; color: var(--text-primary); }
        .table-info { font-size: 0.8rem; color: var(--text-muted); }

        /* --- MEDIA QUERIES --- */
        @media (max-width: 1024px) {
            .sidebar { width: 80px; padding: 20px 0; }
            .nav-item span { display: none; } 
            .nav-item { justify-content: center; padding: 16px 0; }
            .nav-label, .sidebar-footer { display: none; }
            .dish-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
        }

        @media (max-width: 768px) {
            .app-header { padding: 0 16px; }
            .mobile-menu-btn { display: block; }
            .sidebar {
                position: fixed; inset: 0; width: 280px; z-index: 250;
                transform: translateX(-100%); padding: 20px;
                background: var(--bg-sidebar);
                box-shadow: 10px 0 30px rgba(0,0,0,0.5);
            }
            .sidebar.open { transform: translateX(0); }
            .sidebar .nav-item span { display: inline; } 
            .sidebar .nav-item { justify-content: flex-start; padding: 16px 24px; font-size: 1.1rem; }
            .sidebar-footer { display: block; margin-top: auto; }
            
            .main-content { padding: 16px 16px 80px 16px; }
            .dish-grid { grid-template-columns: 1fr; gap: 20px; }
            
            .mobile-cart-bar { display: flex; }
            .btn-add { width: 100%; margin-top: 8px; }
            .card-img-container { height: 180px; }
            
            /* Overlay scuro sidebar mobile */
            .sidebar-overlay {
                position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 240;
                opacity: 0; pointer-events: none; transition: 0.3s;
            }
            .sidebar.open + .sidebar-overlay { opacity: 1; pointer-events: auto; }
        }

        /* --- START MODAL & DELIVERY STYLES --- */
        .start-options { display: flex; flex-direction: column; gap: 16px; margin-top: 20px; width: 100%; }
        .btn-start {
            padding: 24px; font-size: 1.2rem; font-weight: 700;
            background: rgba(255,255,255,0.05); border: 1px solid var(--border-color);
            border-radius: var(--radius-card); color: var(--text-primary);
            cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 12px;
        }
        .btn-start:hover { background: var(--bg-card-hover); border-color: var(--color-accent); color: var(--color-accent); transform: translateY(-2px); }

        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 0.9rem; margin-bottom: 8px; color: var(--text-secondary); font-weight: 500; }
        .form-input {
            width: 100%; padding: 14px; background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color); border-radius: 10px;
            color: white; font-family: inherit; font-size: 1rem;
        }
        .form-input:focus { outline: none; border-color: var(--color-accent); background: rgba(255,255,255,0.08); }
        .shipping-cost-alert { 
            margin: 24px 0; text-align: center; color: var(--text-primary); 
            background: rgba(0, 229, 255, 0.1); padding: 16px; border-radius: 12px; border: 1px solid rgba(0, 229, 255, 0.2);
        }

    </style>
</head>
<body>

    <!-- HEADER -->
    <header class="app-header">
        <div class="logo-area">
            <button class="mobile-menu-btn" id="btn-menu-toggle">‚ò∞</button>
            <div class="brand-name">Totem Self</div>
        </div>
        <div class="header-actions">
            <div class="table-status-display" id="selected-table-display">Seleziona Tavolo</div>
            <button class="btn-pill" onclick="openTableModal()">Tavoli</button>
        </div>
    </header>

    <div class="app-body">
        <!-- SIDEBAR -->
        <nav class="sidebar" id="sidebar">
            <div class="nav-label">Menu Ristorante</div>
            <div id="nav-links-container">
                <!-- Generato via JS -->
            </div>

            <div class="sidebar-footer">
                <div class="total-box">
                    <div class="total-label">Totale Ordine</div>
                    <div class="total-amount" id="sidebar-total">‚Ç¨ 0,00</div>
                    <div style="font-size: 0.85rem; color: #888; margin-top: 6px;" id="items-count">0 articoli</div>
                </div>
                <!-- Il pulsante ora apre il Modal Carrello invece di inviare subito -->
                <button class="btn-add" style="width: 100%; margin-top: 16px; background: #333; color:white; border: 1px solid #444;" onclick="checkout()">
                    Vedi Carrello
                </button>
            </div>
        </nav>
        <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

        <!-- MAIN CONTENT -->
        <main class="main-content" id="main-scroll">
            <div id="menu-container">
                <!-- Generato via JS -->
            </div>
        </main>
    </div>

    <!-- MOBILE BOTTOM BAR -->
    <div class="mobile-cart-bar">
        <div>
            <div style="font-size: 0.8rem; color: #aaa;">Totale stimato</div>
            <div class="mobile-total" id="mobile-total">‚Ç¨ 0,00</div>
        </div>
        <button class="btn-mobile-checkout" onclick="checkout()">Vedi Carrello</button>
    </div>

    <!-- START MODE MODAL -->
    <div class="modal-backdrop" id="start-modal" style="z-index: 500;">
        <div class="modal-panel" style="max-width: 450px; text-align: center;">
            <div class="modal-header" style="justify-content: center; margin-bottom: 10px;">
                <div class="modal-title" style="font-size: 1.6rem;">Benvenuto</div>
            </div>
            <div style="color: var(--text-secondary); margin-bottom: 24px;">Scegli come preferisci ordinare</div>
            <div class="start-options">
                <button class="btn-start" onclick="selectMode('sala')">
                    <span style="font-size: 1.5rem;">üçΩÔ∏è</span> Sala
                </button>
                <button class="btn-start" onclick="selectMode('asporto')">
                    <span style="font-size: 1.5rem;">üõçÔ∏è</span> Asporto
                </button>
                <button class="btn-start" onclick="selectMode('delivery')">
                    <span style="font-size: 1.5rem;">üõµ</span> Delivery
                </button>
            </div>
        </div>
    </div>

    <!-- ASPORTO INFO MODAL -->
    <div class="modal-backdrop" id="asporto-modal" style="z-index: 450;">
        <div class="modal-panel" style="max-width: 400px; text-align: center;">
            <div class="modal-header" style="justify-content: center;">
                <div class="modal-title">Ordine d'Asporto</div>
            </div>
            <div style="font-size: 1.1rem; line-height: 1.6; color: var(--text-secondary); margin-bottom: 30px;">
                Completa l'ordine qui e poi<br><strong style="color:white;">vai al bancone</strong> per il ritiro.
            </div>
            <button class="btn-confirm" onclick="closeAsportoModal()">OK, Continua</button>
        </div>
    </div>

    <!-- DELIVERY ADDRESS MODAL -->
    <div class="modal-backdrop" id="delivery-modal" style="z-index: 450;">
        <div class="modal-panel">
            <div class="modal-header">
                <div class="modal-title">Dati Spedizione</div>
                <button class="modal-close" onclick="closeDeliveryModal()">&times;</button> 
            </div>
            <div style="overflow-y: auto; max-height: 60vh; padding: 4px;">
                <div class="form-group">
                    <label class="form-label">Nome e Cognome</label>
                    <input type="text" id="del-name" class="form-input" placeholder="Es. Mario Rossi">
                </div>
                <div class="form-group">
                    <label class="form-label">Indirizzo</label>
                    <input type="text" id="del-address" class="form-input" placeholder="Via Roma 10">
                </div>
                <div class="form-group">
                    <label class="form-label">Citt√† / CAP</label>
                    <input type="text" id="del-city" class="form-input" placeholder="Milano">
                </div>
                <div class="form-group">
                    <label class="form-label">Note per il driver (opzionale)</label>
                    <textarea id="del-notes" class="form-input" rows="2" placeholder="Es. Citofono rotto"></textarea>
                </div>
                
                <div class="shipping-cost-alert">
                    <strong>La spedizione costa 3,99 ‚Ç¨.</strong>
                </div>
            </div>
            <div class="cart-footer-panel">
                <button class="btn-confirm" onclick="confirmDeliveryData()">Conferma Indirizzo</button>
            </div>
        </div>
    </div>

    <!-- TABLE SELECTION MODAL -->
    <div class="modal-backdrop" id="table-modal">
        <div class="modal-panel">
            <div class="modal-header">
                <div class="modal-title">Seleziona Tavolo</div>
                <button class="modal-close" onclick="closeTableModal()">&times;</button>
            </div>
            <div class="table-grid-scroll">
                <div class="table-grid" id="table-grid">
                    <!-- Generato via JS -->
                </div>
            </div>
            <div style="margin-top: 20px; font-size: 0.85rem; color: var(--text-muted); text-align: center;">
                Rosso = Occupato ‚Ä¢ Seleziona un tavolo per iniziare
            </div>
        </div>
    </div>

    <!-- NEW CART MODAL -->
    <div class="modal-backdrop" id="cart-modal">
        <div class="modal-panel">
            <div class="modal-header">
                <div class="modal-title">Riepilogo Ordine</div>
                <button class="modal-close" onclick="closeCartModal()">&times;</button>
            </div>
            <div class="cart-items-list" id="cart-items-list">
                <!-- Generato via JS -->
            </div>
            <div class="cart-footer-panel">
                <div class="cart-summary-row">
                    <span>Totale</span>
                    <span id="cart-modal-total" style="color: var(--color-accent);">‚Ç¨ 0,00</span>
                </div>
                <button class="btn-confirm" onclick="confirmOrder()">Conferma e Invia In Cucina</button>
            </div>
        </div>
    </div>

    <script>
        /* 
         * DATI MENU
         * Immagini aggiornate per TUTTI i piatti mancanti.
         */
         const menuData = {
            "tavoli": [
                { "id": "1", "name": "Tavolo 1", "area": "Sala principale", "maxCovers": 4, "stato": "LIBERO" },
                { "id": "2", "name": "Tavolo 2", "area": "Sala principale", "maxCovers": 4, "stato": "LIBERO" },
                { "id": "3", "name": "Tavolo 3", "area": "Terrazza", "maxCovers": 2, "stato": "LIBERO" },
                { "id": "4", "name": "Tavolo 4", "area": "Sala principale", "maxCovers": 6, "stato": "LIBERO" },
                { "id": "5", "name": "Tavolo 5", "area": "Terrazza", "maxCovers": 4, "stato": "LIBERO" },
                { "id": "6", "name": "Tavolo 6", "area": "Sala principale", "maxCovers": 2, "stato": "LIBERO" },
                { "id": "7", "name": "Tavolo 7", "area": "Giardino", "maxCovers": 8, "stato": "LIBERO" },
                { "id": "8", "name": "Tavolo 8", "area": "Sala principale", "maxCovers": 2, "stato": "LIBERO" }
            ],
            "menu": {
                "Primi": [
                    { "id": 1, "name": "Spaghetti Carbonara", "desc": "Guanciale croccante, tuorlo d'uovo, pecorino romano DOP.", "price": 12.5, "imageUrl": "https://media-assets.lacucinaitaliana.it/photos/61fd250e7e33782b60f4b6c2/1:1/w_2560%2Cc_limit/Carbonara-classica.jpg" },
                    { "id": 2, "name": "Pappardelle al Cinghiale", "desc": "Pasta fresca all'uovo con rag√π di cinghiale marinato.", "price": 14.0, "imageUrl": "https://www.giallozafferano.it/images/5-531/Pappardelle-al-ragu-di-cinghiale_780x520_wm.jpg" },
                    { "id": 3, "name": "Risotto ai Funghi", "desc": "Riso Carnaroli mantecato con funghi porcini freschi.", "price": 13.0, "imageUrl": "https://images.unsplash.com/photo-1476124369491-e7addf5db371?auto=format&fit=crop&w=600&q=80" },
                    { "id": 101, "name": "Lasagne alla Bolognese", "desc": "Sfoglia verde, rag√π classico, besciamella.", "price": 11.0, "imageUrl": "https://www.ricettealvolo.it/wp-content/uploads/2023/02/lasagne-bolognese.jpg" },
                    { "id": 102, "name": "Gnocchi al Pesto", "desc": "Gnocchi di patate con pesto alla genovese fresco.", "price": 10.0, "imageUrl": "https://qbcucina.com/cdn/shop/articles/img-1713808789633_a37501db-2cb5-404a-9bff-eed4f8c45977_1200x.png?v=1713810591" },
                    { "id": 103, "name": "Ravioli Burro e Salvia", "desc": "Ravioli ripieni di ricotta e spinaci, saltati.", "price": 12.0, "imageUrl": "https://www.lucianamosconi.com/wp-content/uploads/2024/10/Ravioloni-la-pasta-fresca-luciana-mosconi-burro-salvia-ericotta-dura.jpg" }
                ],
                "Secondi": [
                    { "id": 4, "name": "Bistecca alla Fiorentina", "desc": "Taglio di scottona frollata, cotta alla brace.", "price": 28.0, "imageUrl": "https://www.italieonline.eu/img/t750h0/blogimg/leto/gastro/bistecca-alla-fiorentina.jpg" },
                    { "id": 5, "name": "Branzino al Forno", "desc": "Filetto di branzino pescato con patate e olive.", "price": 24.0, "imageUrl": "https://www.giallozafferano.it/images/222-22246/Branzino-al-forno_450x300.jpg" },
                    { "id": 6, "name": "Pollo ai Peperoni", "desc": "Pollo ruspante stufato con peperoni colorati.", "price": 16.5, "imageUrl": "https://media-assets.lacucinaitaliana.it/photos/62d56a39fdc20f22ade8c492/3:2/w_7214,h_4809,c_limit/pollo%20alla%20romana%20con%20peperoni%20secondo%20piatto.jpg" },
                    { "id": 104, "name": "Filetto al Pepe Verde", "desc": "Tenero filetto di manzo con salsa cremosa.", "price": 22.0, "imageUrl": "https://www.sfizioso.it/wp-content/uploads/2020/07/ricetta-filetto-al-pepe-verde.png" },
                    { "id": 105, "name": "Grigliata Mista", "desc": "Selezione di carni miste alla griglia.", "price": 18.0, "imageUrl": "https://cdn.shopify.com/s/files/1/1186/6036/files/assorted-meat-kebab-with-onions-herbs-grilled-vegetables_140725-5629_480x480.jpg?v=1647444946" },
                    { "id": 106, "name": "Cotoletta alla Milanese", "desc": "Cotoletta di vitello impanata e fritta nel burro.", "price": 14.0, "imageUrl": "https://www.tavolartegusto.it/wp/wp-content/uploads/2022/05/Cotoletta-alla-milanese-1-1.jpg" }
                ],
                "Contorni": [
                    { "id": 7, "name": "Patate al Forno", "desc": "Patate novelle arrosto con rosmarino.", "price": 5.0, "imageUrl": "https://tempodicottura.it/wp-content/uploads/2021/01/patate-al-forno.jpg" },
                    { "id": 8, "name": "Spinaci Saltati", "desc": "Spinaci freschi saltati in padella.", "price": 6.0, "imageUrl": "https://blog.giallozafferano.it/renatabriano/wp-content/uploads/2020/01/Spinaci-saltati-in-padella-960x1200.jpg" },
                    { "id": 9, "name": "Insalata Mista", "desc": "Misticanza, pomodorini, carote e finocchi.", "price": 4.5, "imageUrl": "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=600&q=80" },
                    { "id": 107, "name": "Verdure Grigliate", "desc": "Zucchine, melanzane e peperoni grigliati.", "price": 6.0, "imageUrl": "https://primochef.it/wp-content/uploads/2018/07/SH_tipi_di_verdure_grigliate.jpg.webp" },
                    { "id": 108, "name": "Patatine Fritte", "desc": "Patatine taglio classico croccanti.", "price": 4.5, "imageUrl": "https://blog.giallozafferano.it/allacciateilgrembiule/wp-content/uploads/2021/01/patatine-fritte-fatte-in-casa.jpg" }
                ],
                "Dolci": [
                    { "id": 10, "name": "Tiramis√π", "desc": "Classico dolce con savoiardi, caff√® e mascarpone.", "price": 8.0, "imageUrl": "https://upload.wikimedia.org/wikipedia/commons/thumb/5/58/Tiramisu_-_Raffaele_Diomede.jpg/640px-Tiramisu_-_Raffaele_Diomede.jpg" },
                    { "id": 11, "name": "Panna Cotta", "desc": "Panna cotta vaniglia con frutti rossi.", "price": 7.5, "imageUrl": "https://assets.tmecosys.com/image/upload/t_web_rdp_recipe_584x480/img/recipe/ras/Assets/EAD7A075-44A1-4530-8D3A-CF3DB64450D4/Derivates/10F63431-377A-4844-8ECA-F34FE65D344F.jpg" },
                    { "id": 12, "name": "Gelato Assortito", "desc": "Tre palline di gelato artigianale.", "price": 6.0, "imageUrl": "https://images.unsplash.com/photo-1560008581-09826d1de69e?auto=format&fit=crop&w=600&q=80" },
                    { "id": 109, "name": "Cheesecake", "desc": "Torta al formaggio fredda con topping.", "price": 7.0, "imageUrl": "https://images.unsplash.com/photo-1524351199678-941a58a3df50?auto=format&fit=crop&w=600&q=80" },
                    { "id": 110, "name": "Tortino al Cioccolato", "desc": "Tortino caldo con cuore morbido fondente.", "price": 7.5, "imageUrl": "https://blog.giallozafferano.it/adryincucina/wp-content/uploads/2017/10/tortino-al-cioccolato-e1571486491966.jpg" },
                    { "id": 111, "name": "Sorbetto al Limone", "desc": "Sorbetto fresco al limone di Sicilia.", "price": 5.0, "imageUrl": "https://blog.giallozafferano.it/dulcisinforno/wp-content/uploads/2018/12/Sorbetto-al-limone-cremoso-in-5-minuti-senza-gelatiera-6447.jpg" }
                ],
                "Bevande": [
                    { "id": 13, "name": "Acqua Naturale 0.5L", "desc": "Bottiglia in vetro.", "price": 2.5, "imageUrl": "https://www.acqua.store/wp-content/uploads/2022/02/Valverde-50cl-naturale.jpg" },
                    { "id": 14, "name": "Vino Rosso", "desc": "Calice di Chianti o rosso locale.", "price": 8.0, "imageUrl": "https://www.dacforniture.com/12054-home_default/6-calici-chianti-classico.jpg" },
                    { "id": 15, "name": "Birra 0.33L", "desc": "Birra bionda alla spina.", "price": 5.0, "imageUrl": "https://www.gazzettadelgusto.it/wp-content/uploads/2024/05/Guida-alle-Birre-d-Italia-2025-Slow-Food-Editore.jpg" },
                    { "id": 16, "name": "Caff√®", "desc": "Espresso italiano.", "price": 2.0, "imageUrl": "https://cdn.shopify.com/s/files/1/0601/8783/6659/files/Espresso-cup-with-coffee-beans.jpg?v=1655750550" },
                    { "id": 112, "name": "Coca Cola", "desc": "Lattina 33cl.", "price": 3.0, "imageUrl": "https://images.unsplash.com/photo-1622483767028-3f66f32aef97?auto=format&fit=crop&w=600&q=80" },
                    { "id": 113, "name": "Aranciata", "desc": "Lattina 33cl.", "price": 3.0, "imageUrl": "https://images.unsplash.com/photo-1613478223719-2ab802602423?auto=format&fit=crop&w=600&q=80" },
                    { "id": 114, "name": "Spritz Aperol", "desc": "Aperitivo con prosecco, aperol e soda.", "price": 6.0, "imageUrl": "https://blog.giallozafferano.it/incucinadaeva/wp-content/uploads/2020/06/Spritz.png" },
                    { "id": 115, "name": "Calice Prosecco", "desc": "Prosecco DOC extra dry.", "price": 5.0, "imageUrl": "https://m.media-amazon.com/images/I/519eEVIGzvL._AC_.jpg" }
                ]
            }
        };

        // --- STATO DELL'APP ---
        let cart = {}; 
        let currentTable = null;
        let orderMode = null; // 'sala', 'asporto', 'delivery'
        let deliveryAddress = null;

        let isManualScrolling = false; // Flag per prevenire conflitti tra click e scroll

        // --- DOM ELEMENTS ---
        const navContainer = document.getElementById('nav-links-container');
        const menuContainer = document.getElementById('menu-container');
        const sidebarTotal = document.getElementById('sidebar-total');
        const mobileTotal = document.getElementById('mobile-total');
        const itemsCountEl = document.getElementById('items-count');
        const tableDisplay = document.getElementById('selected-table-display');
        const cartModalTotal = document.getElementById('cart-modal-total');
        const cartItemsList = document.getElementById('cart-items-list');
        const mainScrollEl = document.getElementById('main-scroll');

        // --- INIT ---
        function init() {
            renderSidebar();
            renderMenu();
            renderTables();
            updateTotals();
            
            // Mobile Menu Toggle
            document.getElementById('btn-menu-toggle').addEventListener('click', toggleSidebar);
            
            // Se non c'√® tavolo selezionato, apri modal tavoli
            openStartModal();

            // Inizializza Scroll Spy
            initScrollSpy();
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // --- RENDER FUNCTIONS ---
        function renderSidebar() {
            const categories = Object.keys(menuData.menu);
            navContainer.innerHTML = '';
            
            categories.forEach((cat, index) => {
                const link = document.createElement('a');
                link.className = `nav-item ${index === 0 ? 'active' : ''}`;
                link.innerHTML = `<span>${cat}</span>`;
                link.href = `#cat-${cat}`;
                link.dataset.target = `cat-${cat}`;
                
                // Intercetta il click per scroll manuale
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    scrollToCategory(cat);
                    // Chiudi sidebar mobile se aperta
                    document.getElementById('sidebar').classList.remove('open');
                });
                
                navContainer.appendChild(link);
            });
        }

        function renderMenu() {
            menuContainer.innerHTML = '';
            for (const [category, dishes] of Object.entries(menuData.menu)) {
                const section = document.createElement('section');
                section.id = `cat-${category}`; // ID coerente con il link
                section.style.marginBottom = "40px";
                
                section.innerHTML = `
                    <h2 class="section-title">
                        ${category} <span class="section-count">${dishes.length}</span>
                    </h2>
                    <div class="dish-grid">
                        ${dishes.map(dish => createDishCard(dish, category)).join('')}
                    </div>
                `;
                menuContainer.appendChild(section);
            }
        }

        function createDishCard(dish, category) {
            const imgUrl = dish.imageUrl || 'https://via.placeholder.com/600x400?text=No+Image';
            const safeName = dish.name.replace(/'/g, "\\'");
            const safeImg = imgUrl.replace(/'/g, "\\'");
            
            return `
                <div class="dish-card">
                    <div class="card-img-container">
                        <img src="${imgUrl}" class="card-img" alt="${dish.name}" loading="lazy">
                    </div>
                    <div class="card-body">
                        <div class="card-header">
                            <div class="dish-name">${dish.name}</div>
                            <div class="status-dot" title="Disponibile"></div>
                        </div>
                        <div class="dish-desc" title="${dish.desc}">${dish.desc}</div>
                        <div class="card-footer">
                            <div>
                                <span class="dish-category-tag">${category}</span>
                                <div class="price-tag" style="margin-top:6px;">‚Ç¨ ${dish.price.toFixed(2)}</div>
                            </div>
                            <button class="btn-add" onclick="addToCart('${dish.id}', '${safeName}', ${dish.price}, '${safeImg}')">
                                + Aggiungi
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTables() {
            const grid = document.getElementById('table-grid');
            grid.innerHTML = menuData.tavoli.map(t => {
                const isOccupied = t.stato !== 'LIBERO';
                const occupiedClass = isOccupied ? 'occupied' : '';
                return `
                    <div class="table-select-card ${occupiedClass}" onclick="selectTable('${t.id}', '${t.name}')" id="t-${t.id}">
                        <div class="table-name">${t.name}</div>
                        <div class="table-info">${t.area}</div>
                        <div class="table-info" style="margin-top:4px;">${t.maxCovers} pax</div>
                    </div>
                `;
            }).join('');
        }

        // --- SCROLL & NAV LOGIC ---
        
        function scrollToCategory(cat) {
            const targetId = `cat-${cat}`;
            const targetEl = document.getElementById(targetId);
            
            if (targetEl) {
                isManualScrolling = true;
                
                // Aggiorna subito visualmente la sidebar per reattivit√† immediata al click
                updateActiveLink(targetId);

                // Calcola posizione scroll
                const headerOffset = 20; // Piccola correzione per estetica
                const elementPosition = targetEl.getBoundingClientRect().top;
                const offsetPosition = elementPosition + mainScrollEl.scrollTop - headerOffset;

                mainScrollEl.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth"
                });

                // Riabilita l'observer dopo un tempo ragionevole per lo scroll
                setTimeout(() => {
                    isManualScrolling = false;
                }, 800);
            }
        }

        function updateActiveLink(targetId) {
            document.querySelectorAll('.nav-item').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.target === targetId) {
                    link.classList.add('active');
                    // Scrolla anche la sidebar per mantenere visibile la voce attiva
                    link.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                }
            });
        }

        function initScrollSpy() {
            // Intersection Observer per monitorare quale sezione √® visibile
            const observerOptions = {
                root: mainScrollEl, // Lo scroll container √® il main, non il body
                rootMargin: '-10% 0px -70% 0px', // Active point: 10% top -> trigger
                threshold: 0
            };

            const observerCallback = (entries) => {
                // Se stiamo scrollando via click, ignora per evitare flickering
                if (isManualScrolling) return;

                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        updateActiveLink(entry.target.id);
                    }
                });
            };

            const observer = new IntersectionObserver(observerCallback, observerOptions);

            // Osserva tutte le sezioni
            document.querySelectorAll('section[id^="cat-"]').forEach(section => {
                observer.observe(section);
            });
        }


        // --- CART LOGIC ---
        
        function addToCart(id, name, price, img) {
            if (!cart[id]) {
                cart[id] = { qty: 0, price: price, name: name, img: img };
            }
            cart[id].qty++;
            updateTotals();
            
            const btn = event.target;
            const originalText = btn.innerText;
            btn.innerText = "Aggiunto!";
            btn.style.background = "var(--status-green)";
            btn.style.color = "#000";
            setTimeout(() => {
                btn.innerText = originalText;
                btn.style.background = "";
                btn.style.color = "";
            }, 800);
        }

        function updateTotals() {
            let total = 0;
            let count = 0;
            Object.values(cart).forEach(item => {
                total += item.qty * item.price;
                count += item.qty;
            });
            
            // NEW: Delivery Cost
            if (orderMode === 'delivery') {
                total += 3.99;
            }
            
            const fmt = "‚Ç¨ " + total.toFixed(2);
            sidebarTotal.innerText = fmt;
            mobileTotal.innerText = fmt;
            cartModalTotal.innerText = fmt;
            itemsCountEl.innerText = count + (count === 1 ? " articolo" : " articoli");
        }

        function checkout() {
            if (Object.keys(cart).length === 0) {
                alert("Il carrello √® vuoto.");
                return;
            }
            renderCartItems();
            document.getElementById('cart-modal').classList.add('visible');
        }

        function openCartModal() { checkout(); } // Alias
        function closeCartModal() { document.getElementById('cart-modal').classList.remove('visible'); }

        function renderCartItems() {
            cartItemsList.innerHTML = '';
            
            // Se vuoto
            if (Object.keys(cart).length === 0) {
                // Se delivery, mostriamo comunque la spedizione se forzassimo il rendering, 
                // ma il checkout() blocca l'apertura se vuoto. 
                // Tuttavia se arriviamo qui, mostriamo messaggio standard.
                cartItemsList.innerHTML = '<div style="text-align:center; padding:20px; color:#888;">Carrello vuoto</div>';
                closeCartModal(); 
                return;
            }

            // Render Food Items
            for (const [id, item] of Object.entries(cart)) {
                const row = document.createElement('div');
                row.className = 'cart-item-row';
                row.innerHTML = `
                    <img src="${item.img}" class="cart-thumb" alt="foto">
                    <div class="cart-item-details">
                        <div class="cart-item-title">${item.name}</div>
                        <div class="cart-item-meta">‚Ç¨ ${item.price.toFixed(2)} cad.</div>
                    </div>
                    <div class="qty-controls">
                        <button class="qty-btn" onclick="updateQty('${id}', -1)">-</button>
                        <span class="qty-val">${item.qty}</span>
                        <button class="qty-btn" onclick="updateQty('${id}', 1)">+</button>
                    </div>
                    <div style="font-weight:bold; min-width:60px; text-align:right;">
                        ‚Ç¨ ${(item.price * item.qty).toFixed(2)}
                    </div>
                    <button class="btn-remove" onclick="removeFromCart('${id}')">&times;</button>
                `;
                cartItemsList.appendChild(row);
            }

            // NEW: Render Shipping Item if Delivery
            if (orderMode === 'delivery') {
                const row = document.createElement('div');
                row.className = 'cart-item-row';
                row.style.background = "rgba(0, 229, 255, 0.05)";
                row.innerHTML = `
                    <div class="cart-thumb" style="background: #222; display:flex; align-items:center; justify-content:center; font-size:1.5rem;">üõµ</div>
                    <div class="cart-item-details">
                        <div class="cart-item-title">Spedizione</div>
                        <div class="cart-item-meta">Tariffa fissa</div>
                    </div>
                    <div class="qty-controls" style="opacity:0; pointer-events:none;"></div>
                    <div style="font-weight:bold; min-width:60px; text-align:right; color: var(--color-accent);">
                        ‚Ç¨ 3.99
                    </div>
                    <button class="btn-remove" style="opacity:0; pointer-events:none;">&times;</button>
                `;
                cartItemsList.appendChild(row);
            }
            
            updateTotals();
        }

        function updateQty(id, delta) {
            if (cart[id]) {
                cart[id].qty += delta;
                if (cart[id].qty <= 0) delete cart[id];
                updateTotals();
                renderCartItems();
            }
        }

        function removeFromCart(id) {
            if (cart[id]) {
                delete cart[id];
                updateTotals();
                renderCartItems();
            }
        }

        /* OLD confirmOrder removed */ 
        function confirmOrder_OLD() {
            if (!currentTable) {
                alert("‚ö†Ô∏è Devi selezionare un tavolo prima di inviare l'ordine!");
                closeCartModal();
                openTableModal();
                return;
            }
            const orderData = { table: currentTable.name, items: cart, timestamp: new Date().toLocaleString() };
            console.log("INVIO ORDINE:", orderData);
            alert(`‚úÖ Ordine inviato con successo per ${currentTable.name}!`);
            cart = {};
            updateTotals();
            closeCartModal();
        }

        // --- TABLE MODAL ---
        function openTableModal() { document.getElementById('table-modal').classList.add('visible'); }
        function closeTableModal() { document.getElementById('table-modal').classList.remove('visible'); }
        function selectTable(id, name) {
            currentTable = { id, name };
            tableDisplay.innerText = name;
            document.querySelectorAll('.table-select-card').forEach(el => el.classList.remove('selected'));
            const card = document.getElementById(`t-${id}`);
            if(card) card.classList.add('selected');
            setTimeout(closeTableModal, 200);
        }

        
        function confirmOrder() {
            if (Object.keys(cart).length === 0) {
                alert("Il carrello √® vuoto.");
                return;
            }

            // Validazione
            if (orderMode === 'sala' && !currentTable) {
                alert("‚ö†Ô∏è Seleziona un tavolo.");
                closeCartModal();
                openTableModal();
                return;
            }
            if (orderMode === 'delivery' && !deliveryAddress) {
                alert("‚ö†Ô∏è Inserisci indirizzo.");
                closeCartModal();
                document.getElementById('delivery-modal').classList.add('visible');
                return;
            }

            const orderPayload = {
                mode: orderMode,
                items: cart,
                timestamp: new Date().toLocaleString()
            };
            
            if(orderMode === 'sala') orderPayload.table = currentTable.name;
            if(orderMode === 'delivery') {
                orderPayload.address = deliveryAddress;
                orderPayload.shipping = 3.99;
            }
            
            console.log("INVIO ORDINE:", orderPayload);
            
            let msg = "‚úÖ Ordine inviato!";
            if (orderMode === 'delivery') msg += "\nSpedizione: 3,99 ‚Ç¨ inclusa.";
            alert(msg);
            
            cart = {};
            updateTotals();
            closeCartModal();
        }

        // --- NEW LOGIC FUNCTIONS ---
        function openStartModal() { 
            document.getElementById('start-modal').classList.add('visible'); 
        }
        
        function selectMode(mode) {
            orderMode = mode;
            document.getElementById('start-modal').classList.remove('visible');
            
            // Update totals immediately to show shipping cost if delivery
            updateTotals();

            if (mode === 'sala') {
                openTableModal();
            } else if (mode === 'asporto') {
                document.getElementById('asporto-modal').classList.add('visible');
            } else if (mode === 'delivery') {
                document.getElementById('delivery-modal').classList.add('visible');
            }
        }
        
        function closeAsportoModal() {
            document.getElementById('asporto-modal').classList.remove('visible');
        }
        
        function closeDeliveryModal() {
            document.getElementById('delivery-modal').classList.remove('visible');
            if (!deliveryAddress) openStartModal(); 
        }
        
        function confirmDeliveryData() {
            const name = document.getElementById('del-name').value.trim();
            const addr = document.getElementById('del-address').value.trim();
            const city = document.getElementById('del-city').value.trim();
            const notes = document.getElementById('del-notes').value.trim();
            
            if (!name || !addr || !city) {
                alert("Inserisci Nome, Indirizzo e Citt√† per continuare.");
                return;
            }
            
            deliveryAddress = { name, address: addr, city, notes };
            document.getElementById('delivery-modal').classList.remove('visible');
        }

        // Avvio app
        init();
    </script>
</body>
</html>
 
    </template>

    <template id="app-c">
        

<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Display System - Neon Edition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* ====================================================================
           VARIABILI NEON & RESET
           ==================================================================== */
        :root {
            /* Colori Neon */
            --neon-cyan: #00E5FF;
            --neon-magenta: #FF00FF;
            --neon-green: #00FF9F;
            --neon-yellow: #FFB800;
            --neon-red: #FF3366;

            /* Background Dark */
            --bg-void: #020617;
            --bg-deep: #050B25;
            --bg-panel: rgba(10, 20, 40, 0.9);
            --bg-card-dark: rgba(15, 25, 50, 0.95);
            --bg-card-light: #ffffff;

            /* Background scuro sfumato per card unificate */
            --bg-card-unified: linear-gradient(135deg, rgba(15, 25, 50, 0.95) 0%, rgba(25, 35, 65, 0.9) 50%, rgba(20, 30, 55, 0.95) 100%);

            /* Testo */
            --text-white: #FFFFFF;
            --text-gray: #94A3B8;
            --text-black: #0F1729;

            /* Spaziature */
            --radius-lg: 20px;
            --radius-xl: 28px;
            --spacing: 2rem;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Nasconde scrollbar ma mantiene scroll con rotellina/touch */
        html {
            font-size: 100%;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }

        html::-webkit-scrollbar,
        body::-webkit-scrollbar,
        *::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
            width: 0;
            height: 0;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: linear-gradient(135deg, var(--bg-void) 0%, var(--bg-deep) 100%);
            color: var(--text-white);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            position: relative;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        /* Background decorativo con linee curve */
        body::before {
            content: "";
            position: fixed;
            top: -20%;
            left: -15%;
            width: 70vw;
            height: 70vh;
            border: 2px solid rgba(0, 229, 255, 0.08);
            border-radius: 45% 55% 60% 40%;
            z-index: 0;
            pointer-events: none;
            animation: float 20s ease-in-out infinite;
        }

        body::after {
            content: "";
            position: fixed;
            bottom: -15%;
            right: -10%;
            width: 60vw;
            height: 60vh;
            border: 2px solid rgba(255, 0, 255, 0.06);
            border-radius: 40% 60% 55% 45%;
            z-index: 0;
            pointer-events: none;
            animation: float 25s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(5deg); }
            66% { transform: translate(-20px, 20px) rotate(-3deg); }
        }

        /* Canvas per particle system */
        #particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            opacity: 0.4;
        }

        /* ====================================================================
           CLASSI RIUTILIZZABILI NEON GLOW
           ==================================================================== */
        .neon-border--cyan {
            border: 2px solid var(--neon-cyan);
            box-shadow:
                0 0 5px var(--neon-cyan),
                0 0 10px var(--neon-cyan),
                0 0 20px rgba(0, 229, 255, 0.5),
                inset 0 0 15px rgba(0, 229, 255, 0.1);
        }

        .neon-border--magenta {
            border: 2px solid var(--neon-magenta);
            box-shadow:
                0 0 5px var(--neon-magenta),
                0 0 10px var(--neon-magenta),
                0 0 20px rgba(255, 0, 255, 0.5),
                inset 0 0 15px rgba(255, 0, 255, 0.1);
        }

        .neon-border--green {
            border: 2px solid var(--neon-green);
            box-shadow:
                0 0 5px var(--neon-green),
                0 0 10px var(--neon-green),
                0 0 20px rgba(0, 255, 159, 0.5),
                inset 0 0 15px rgba(0, 255, 159, 0.1);
        }

        /* ====================================================================
           NAVBAR HEADER
           ==================================================================== */
        .navbar {
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1.5rem var(--spacing);
            background: rgba(2, 6, 23, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 229, 255, 0.2);
        }

        .navbar-left {
            position: absolute;
            left: var(--spacing);
        }

        .navbar-right {
            position: absolute;
            right: var(--spacing);
        }

        .brand {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 900;
            letter-spacing: 3px;
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-magenta) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 15px rgba(0, 229, 255, 0.6));
        }

        /* Tab Centrali con Glow Neon */
        .nav-tabs {
            display: flex;
            gap: 1rem;
            background: rgba(10, 20, 40, 0.6);
            padding: 8px;
            border-radius: 999px;
            border: 1px solid rgba(0, 229, 255, 0.3);
        }

        .tab-btn {
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-gray);
            padding: 0.75rem 2.5rem;
            border-radius: 999px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, var(--neon-cyan) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            opacity: 0;
        }

        .tab-btn:hover {
            color: var(--neon-cyan);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 229, 255, 0.4);
        }

        .tab-btn.active {
            background: var(--neon-cyan);
            color: #000;
            border-color: var(--neon-cyan);
            box-shadow:
                0 0 20px var(--neon-cyan),
                0 0 30px rgba(0, 229, 255, 0.6),
                0 0 40px rgba(0, 229, 255, 0.4),
                inset 0 0 10px rgba(255, 255, 255, 0.3);
            animation: glow-pulse 2s ease-in-out infinite;
        }

        .tab-btn.active::before {
            width: 300px;
            height: 300px;
            opacity: 0.2;
        }

        @keyframes glow-pulse {
            0%, 100% {
                box-shadow:
                    0 0 20px var(--neon-cyan),
                    0 0 30px rgba(0, 229, 255, 0.6),
                    0 0 40px rgba(0, 229, 255, 0.4);
            }
            50% {
                box-shadow:
                    0 0 30px var(--neon-cyan),
                    0 0 40px rgba(0, 229, 255, 0.8),
                    0 0 50px rgba(0, 229, 255, 0.6);
            }
        }

        /* Info Destra: Orologio + Contatore */
        .nav-info {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .clock-container {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-family: 'Orbitron', monospace;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--neon-cyan);
            text-shadow: 0 0 10px rgba(0, 229, 255, 0.8);
        }

        .clock-icon {
            width: 32px;
            height: 32px;
            border: 3px solid var(--neon-cyan);
            border-radius: 50%;
            position: relative;
            box-shadow:
                0 0 10px var(--neon-cyan),
                inset 0 0 5px rgba(0, 229, 255, 0.3);
            animation: rotate-clock 60s linear infinite;
        }

        .clock-icon::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 50%;
            width: 2px;
            height: 40%;
            background: var(--neon-cyan);
            transform-origin: bottom center;
            transform: translateX(-50%);
            box-shadow: 0 0 5px var(--neon-cyan);
        }

        .clock-icon::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 45%;
            height: 2px;
            background: var(--neon-magenta);
            transform-origin: left center;
            transform: rotate(-90deg);
            box-shadow: 0 0 5px var(--neon-magenta);
        }

        @keyframes rotate-clock {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .order-count {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            line-height: 1.2;
        }

        .order-count span:first-child {
            font-family: 'Orbitron', monospace;
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-green) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 10px rgba(0, 229, 255, 0.8));
            animation: count-pulse 1.5s ease-in-out infinite;
        }

        .order-count span:last-child {
            font-size: 0.7rem;
            color: var(--text-gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @keyframes count-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* ====================================================================
           MAIN AREA & CARD CONTAINER
           ==================================================================== */
        .main-area {
            flex: 1;
            padding: var(--spacing);
            display: flex;
            flex-direction: column;
            gap: var(--spacing);
            position: relative;
            z-index: 10;
        }

        /* Container con Perspective per effetto 3D */
        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2.5rem;
            perspective: 1200px;
            perspective-origin: center center;
        }

        /* Messaggio "Nessun ordine attivo" */
        .no-orders-message {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem 2rem;
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            color: var(--neon-cyan);
            text-shadow: 0 0 20px rgba(0, 229, 255, 0.8);
            animation: message-pulse 2s ease-in-out infinite;
        }

        @keyframes message-pulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* ====================================================================
           CARD UNIFICATA - Stile coerente per tutte le sezioni
           ==================================================================== */
        .order-card {
            background: var(--bg-card-unified);
            border-radius: var(--radius-xl);
            padding: 2rem;
            position: relative;
            min-height: 320px;
            display: flex;
            flex-direction: column;
            border: 3px solid var(--neon-cyan);
            box-shadow:
                0 0 10px var(--neon-cyan),
                0 0 20px rgba(0, 229, 255, 0.4),
                0 0 30px rgba(0, 229, 255, 0.2),
                0 10px 40px rgba(0, 0, 0, 0.5);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .order-card:hover {
            transform: translateY(-12px) rotateX(2deg);
            box-shadow:
                0 0 20px var(--neon-cyan),
                0 0 35px rgba(0, 229, 255, 0.6),
                0 0 50px rgba(0, 229, 255, 0.4),
                0 20px 60px rgba(0, 0, 0, 0.7);
            animation: breathing-glow 2s ease-in-out infinite;
        }

        @keyframes breathing-glow {
            0%, 100% {
                box-shadow:
                    0 0 20px var(--neon-cyan),
                    0 0 35px rgba(0, 229, 255, 0.6),
                    0 0 50px rgba(0, 229, 255, 0.4),
                    0 20px 60px rgba(0, 0, 0, 0.7);
            }
            50% {
                box-shadow:
                    0 0 25px var(--neon-cyan),
                    0 0 40px rgba(0, 229, 255, 0.8),
                    0 0 60px rgba(0, 229, 255, 0.6),
                    0 25px 70px rgba(0, 0, 0, 0.8);
            }
        }

        /* Modalit√† Admin - bordo diverso */
        .order-card.admin-mode {
            border-color: var(--neon-magenta);
            box-shadow:
                0 0 10px var(--neon-magenta),
                0 0 20px rgba(255, 0, 255, 0.4),
                0 0 30px rgba(255, 0, 255, 0.2),
                0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .order-card.admin-mode:hover {
            box-shadow:
                0 0 20px var(--neon-magenta),
                0 0 35px rgba(255, 0, 255, 0.6),
                0 0 50px rgba(255, 0, 255, 0.4),
                0 20px 60px rgba(0, 0, 0, 0.7);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .table-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .table-number {
            font-family: 'Orbitron', monospace;
            font-size: 3rem;
            font-weight: 900;
            color: var(--text-white);
            line-height: 1;
        }

        .order-type-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-gray);
            font-weight: 600;
        }

        .order-code-display {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            font-weight: 900;
            color: var(--text-white);
            opacity: 0.9;
        }

        /* Icona Deliveroo */
        .deliveroo-icon {
            font-size: 4rem;
            text-align: center;
            filter: drop-shadow(0 0 15px rgba(0, 229, 255, 0.8));
            animation: scooter-shake 3s ease-in-out infinite;
        }

        @keyframes scooter-shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            75% { transform: translateX(5px) rotate(2deg); }
        }

        .card-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            flex: 1;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            font-size: 1rem;
            padding: 0.5rem 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.15);
        }

        .detail-label {
            color: var(--text-gray);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
        }

        .detail-value {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            color: var(--text-white);
        }

        /* ====================================================================
           BADGE STATO con Micro-Pulse e Colori
           ==================================================================== */
        .status-badge {
            position: absolute;
            top: -15px;
            right: 20px;
            padding: 0.6rem 1.5rem;
            border-radius: 999px;
            font-family: 'Orbitron', monospace;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.4s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 20;
            animation: badge-pulse 2s ease-in-out infinite;
        }

        @keyframes badge-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        .status-badge:hover {
            transform: scale(1.15) translateY(-3px);
        }

        .status-badge--ordinato {
            background: var(--neon-cyan);
            color: #000;
            box-shadow:
                0 0 15px var(--neon-cyan),
                0 0 25px rgba(0, 229, 255, 0.6);
        }

        .status-badge--preparazione {
            background: var(--neon-yellow);
            color: #000;
            box-shadow:
                0 0 15px var(--neon-yellow),
                0 0 25px rgba(255, 184, 0, 0.6);
        }

        .status-badge--pronto {
            background: var(--neon-green);
            color: #000;
            box-shadow:
                0 0 15px var(--neon-green),
                0 0 25px rgba(0, 255, 159, 0.6);
        }

        .status-badge--consegnato {
            background: #6B7280;
            color: rgba(255, 255, 255, 0.6);
            box-shadow: none;
            opacity: 0.7;
            cursor: default;
            animation: none;
        }

        .status-led {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #000;
            box-shadow: 0 0 8px #000;
            animation: led-blink 1.5s ease-in-out infinite;
        }

        @keyframes led-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* ====================================================================
           MODALE DETTAGLIO ORDINE
           ==================================================================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-card-unified);
            border: 3px solid var(--neon-cyan);
            border-radius: var(--radius-xl);
            padding: 2.5rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow:
                0 0 30px var(--neon-cyan),
                0 0 50px rgba(0, 229, 255, 0.5),
                0 20px 80px rgba(0, 0, 0, 0.9);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(0, 229, 255, 0.3);
        }

        .modal-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--neon-cyan);
            text-shadow: 0 0 15px rgba(0, 229, 255, 0.8);
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--neon-red);
            background: rgba(255, 51, 102, 0.1);
            color: var(--neon-red);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--neon-red);
            color: #000;
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 0 20px var(--neon-red);
        }

        .modal-section {
            margin-bottom: 2rem;
        }

        .modal-section-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--neon-green);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .items-list {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid var(--neon-cyan);
        }

        .item-name {
            font-weight: 600;
            color: var(--text-white);
        }

        .item-qty {
            font-family: 'Orbitron', monospace;
            color: var(--neon-yellow);
            font-weight: 700;
        }

        .item-note {
            font-size: 0.85rem;
            color: var(--text-gray);
            font-style: italic;
            margin-top: 0.3rem;
        }

        /* ====================================================================
           POPUP MENU, ADMIN, QUICK ACTION
           ==================================================================== */
        .popup-menu {
            position: fixed;
            bottom: 100px;
            left: 20px;
            background: var(--bg-card-unified);
            border: 2px solid var(--neon-cyan);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            min-width: 250px;
            box-shadow:
                0 0 20px var(--neon-cyan),
                0 0 40px rgba(0, 229, 255, 0.4);
            z-index: 1500;
            display: none;
            animation: slideUp 0.3s ease-out;
        }

        .popup-menu.active {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .popup-menu-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 229, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Orbitron', monospace;
            font-weight: 600;
            text-align: center;
            color: var(--text-white);
        }

        .popup-menu-item:last-child {
            margin-bottom: 0;
        }

        .popup-menu-item:hover {
            background: var(--neon-cyan);
            color: #000;
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px var(--neon-cyan);
            transform: translateX(5px);
        }

        /* Popup Quick Action (in basso a destra) */
        .popup-quick-action {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: var(--bg-card-unified);
            border: 2px solid var(--neon-green);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            min-width: 280px;
            box-shadow:
                0 0 20px var(--neon-green),
                0 0 40px rgba(0, 255, 159, 0.4);
            z-index: 1500;
            display: none;
            animation: slideUp 0.3s ease-out;
        }

        .popup-quick-action.active {
            display: block;
        }

        .popup-quick-action .popup-menu-item:hover {
            background: var(--neon-green);
            color: #000;
            border-color: var(--neon-green);
            box-shadow: 0 0 15px var(--neon-green);
        }

        /* ====================================================================
           POPUP AGGIUNGI ORDINE
           ==================================================================== */
        .add-order-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .add-order-modal.active {
            display: flex;
        }

        .add-order-content {
            background: var(--bg-card-unified);
            border: 3px solid var(--neon-green);
            border-radius: var(--radius-xl);
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            box-shadow:
                0 0 30px var(--neon-green),
                0 0 50px rgba(0, 255, 159, 0.5);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-family: 'Orbitron', monospace;
            font-weight: 600;
            color: var(--text-gray);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            font-size: 0.85rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 229, 255, 0.3);
            border-radius: 8px;
            color: var(--text-white);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 229, 255, 0.4);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-primary,
        .btn-secondary {
            flex: 1;
            padding: 1rem;
            border-radius: 12px;
            border: none;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--neon-green);
            color: #000;
            box-shadow: 0 0 15px rgba(0, 255, 159, 0.5);
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px var(--neon-green);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-white);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Stili per ordini cliccabili nel registro */
        .registro-order-item {
            padding: 1.5rem;
            margin-bottom: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 229, 255, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .registro-order-item:hover {
            background: rgba(0, 229, 255, 0.1);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 229, 255, 0.3);
            transform: translateX(5px);
        }

        .registro-order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .registro-order-code {
            font-family: 'Orbitron', monospace;
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--neon-cyan);
        }

        .registro-order-time {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            color: var(--text-gray);
        }

        .registro-order-info {
            font-size: 1.8rem;
            color: var(--text-gray);
        }

        .registro-order-details {
            display: none;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px dashed rgba(255, 255, 255, 0.2);
        }

        .registro-order-details.expanded {
            display: block;
        }

        .registro-items-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.6rem;
            color: var(--neon-green);
            margin-bottom: 1rem;
            text-transform: uppercase;
        }

        .registro-order-details .item-row {
            padding: 1rem;
        }

        .registro-order-details .item-name {
            font-size: 1.6rem;
        }

        .registro-order-details .item-qty {
            font-size: 1.6rem;
        }

        .registro-order-details .item-note {
            font-size: 1.3rem;
        }

        /* ====================================================================
           FOOTER
           ==================================================================== */
        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem var(--spacing);
            background: rgba(2, 6, 23, 0.9);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 229, 255, 0.2);
            position: relative;
            z-index: 1000;
        }

        .footer-left {
            flex: 1;
            display: flex;
            justify-content: flex-start;
        }

        .footer-center {
            flex: 1;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .footer-right {
            flex: 1;
            display: flex;
            justify-content: flex-end;
        }

        .menu-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(0, 229, 255, 0.4);
            background: rgba(0, 229, 255, 0.1);
            color: var(--neon-cyan);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.5rem;
        }

        .menu-btn:hover {
            transform: scale(1.1) rotate(90deg);
            background: var(--neon-cyan);
            color: #000;
            box-shadow:
                0 0 20px var(--neon-cyan),
                0 0 30px rgba(0, 229, 255, 0.6);
        }

        .pagination-controls {
            display: flex;
            gap: 1.2rem;
            align-items: center;
        }

        .nav-arrow {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-white);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .nav-arrow:hover {
            transform: scale(1.1);
            border-color: var(--neon-magenta);
            color: var(--neon-magenta);
            box-shadow:
                0 0 15px var(--neon-magenta),
                0 0 25px rgba(255, 0, 255, 0.5);
        }

        .add-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid var(--neon-green);
            background: rgba(0, 255, 159, 0.1);
            color: var(--neon-green);
            font-size: 2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow:
                0 0 15px rgba(0, 255, 159, 0.4);
        }

        .add-btn:hover {
            transform: scale(1.15) rotate(90deg);
            background: var(--neon-green);
            color: #000;
            box-shadow:
                0 0 25px var(--neon-green),
                0 0 40px rgba(0, 255, 159, 0.6);
        }

        .action-btn-main {
            padding: 1rem 3rem;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-magenta) 100%);
            color: #000;
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow:
                0 0 20px rgba(0, 229, 255, 0.5),
                0 0 30px rgba(255, 0, 255, 0.3);
        }

        .action-btn-main:hover {
            transform: scale(1.05);
            box-shadow:
                0 0 30px var(--neon-cyan),
                0 0 40px var(--neon-magenta),
                0 0 50px rgba(0, 229, 255, 0.6);
        }

        .action-btn-main:active {
            transform: scale(0.98);
        }

        /* ====================================================================
           RESPONSIVE
           ==================================================================== */
        @media (max-width: 1024px) {
            .orders-grid {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                gap: 2rem;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            .nav-tabs {
                width: 100%;
            }
            .tab-btn {
                padding: 0.6rem 1.5rem;
                font-size: 0.85rem;
            }
            .nav-info {
                width: 100%;
                justify-content: space-between;
            }
            .orders-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            .footer {
                flex-wrap: wrap;
                gap: 1rem;
                justify-content: center;
            }
            .action-btn-main {
                width: 100%;
            }
        }

        /* ====================================================================
           ANIMAZIONI FADE PER CAMBIO TAB
           ==================================================================== */
        @keyframes fadeInSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .orders-grid > * {
            animation: fadeInSlide 0.5s ease-out forwards;
        }

        .orders-grid > *:nth-child(1) { animation-delay: 0.05s; }
        .orders-grid > *:nth-child(2) { animation-delay: 0.1s; }
        .orders-grid > *:nth-child(3) { animation-delay: 0.15s; }
        .orders-grid > *:nth-child(4) { animation-delay: 0.2s; }
        .orders-grid > *:nth-child(5) { animation-delay: 0.25s; }
        .orders-grid > *:nth-child(6) { animation-delay: 0.3s; }
    </style>
</head>
<body>
    <!-- Canvas Particle System -->
    <canvas id="particles" width="2124.800" height="1668.800"></canvas>
    <!-- NAVBAR HEADER -->
    <header class="navbar">
        <div class="navbar-left">
            <div class="brand">Kitchen Restaurant</div>
        </div>

        <nav class="nav-tabs" role="tablist">
            <button class="tab-btn active" role="tab" aria-selected="true" onclick="kds.setFilter('sala')">Sala</button>
            <button class="tab-btn" role="tab" aria-selected="false" onclick="kds.setFilter('deliveroo')">Deliveroo</button>
            <button class="tab-btn" role="tab" aria-selected="false" onclick="kds.setFilter('asporto')">Asporto</button>
        </nav>

        <div class="navbar-right">
            <div class="nav-info">
                <div class="clock-container">
                    <div class="clock-icon"></div>
                    <span id="clock-display">12:00</span>
                </div>
                <div class="order-count">
                    <span id="count-display">0</span>
                    <span>Ordini Attivi</span>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN AREA -->
    <main class="main-area">
        <div id="orders-container" class="orders-grid">
            <!-- Popolato dinamicamente da JS -->
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="footer-left">
            <button class="menu-btn" onclick="kds.toggleMenu()">
                ‚ò∞
            </button>
        </div>

        <div class="footer-center">
            <button class="nav-arrow" onclick="kds.prevSection()">‚Äπ</button>
            <button class="add-btn" onclick="kds.openAddOrderModal()">+</button>
            <button class="nav-arrow" onclick="kds.nextSection()">‚Ä∫</button>
        </div>

        <div class="footer-right">
            <button class="action-btn-main" onclick="kds.toggleQuickAction()">Quick Action</button>
        </div>
    </footer>

    <!-- POPUP MENU (Menu, Registro, Admin) -->
    <div id="popup-menu" class="popup-menu">
        <div class="popup-menu-item" onclick="kds.openRegistroOrdini()">
            Registro Ordini
        </div>
        <div class="popup-menu-item" onclick="kds.toggleAdminMode()">
            Admin
        </div>
    </div>

    <!-- POPUP QUICK ACTION -->
    <div id="popup-quick-action" class="popup-quick-action">
        <div class="popup-menu-item" onclick="kds.quickAction('preparazione')">
            Metti tutti in preparazione
        </div>
        <div class="popup-menu-item" onclick="kds.quickAction('pronto')">
            Metti tutti pronti
        </div>
        <div class="popup-menu-item" onclick="kds.quickAction('consegnato')">
            Metti tutti consegnati
        </div>
    </div>

    <!-- MODALE DETTAGLIO ORDINE -->
    <div id="modal-order-detail" class="modal-overlay" onclick="kds.closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">Dettaglio Ordine</div>
                <button class="modal-close" onclick="kds.closeModal()">√ó</button>
            </div>

            <div class="modal-section">
                <div class="modal-section-title">Articoli Ordinati</div>
                <div id="modal-items" class="items-list">
                    <!-- Popolato dinamicamente -->
                </div>
            </div>

            <div class="modal-section">
                <div class="modal-section-title">Informazioni Ordine</div>
                <div class="detail-row">
                    <span class="detail-label">Numero Ordine</span>
                    <span class="detail-value" id="modal-order-code">--</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Tipo Ordine</span>
                    <span class="detail-value" id="modal-order-type">--</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Stato Attuale</span>
                    <span class="detail-value" id="modal-order-status">--</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Orario Creazione</span>
                    <span class="detail-value" id="modal-order-time">--</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Tempo Trascorso</span>
                    <span class="detail-value" id="modal-order-elapsed">--</span>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALE AGGIUNGI ORDINE -->
    <div id="add-order-modal" class="add-order-modal">
        <div class="add-order-content">
            <div class="modal-header">
                <div class="modal-title">Aggiungi Ordine</div>
                <button class="modal-close" onclick="kds.closeAddOrderModal()">√ó</button>
            </div>

            <div class="form-group">
                <label class="form-label">Canale</label>
                <select id="new-order-channel" class="form-select">
                    <option value="sala">Sala</option>
                    <option value="deliveroo">Deliveroo</option>
                    <option value="asporto">Asporto</option>
                </select>
            </div>

            <div class="form-group" id="table-group">
                <label class="form-label">Tavolo</label>
                <input type="number" id="new-order-table" class="form-input" placeholder="Numero tavolo" min="1">
            </div>

            <div class="form-group">
                <label class="form-label">Articoli (uno per riga)</label>
                <textarea id="new-order-items" class="form-textarea" placeholder="Es: Pizza Margherita x2&#10;Coca Cola x1"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Note (opzionale)</label>
                <textarea id="new-order-notes" class="form-textarea" placeholder="Note aggiuntive..."></textarea>
            </div>

            <div class="form-buttons">
                <button class="btn-secondary" onclick="kds.closeAddOrderModal()">Annulla</button>
                <button class="btn-primary" onclick="kds.createNewOrder()">Crea Ordine</button>
            </div>
        </div>
    </div>

    <!-- MODALE REGISTRO ORDINI -->
    <div id="registro-modal" class="modal-overlay" onclick="kds.closeRegistroModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">Registro Ordini Completati</div>
                <button class="modal-close" onclick="kds.closeRegistroModal()">√ó</button>
            </div>

            <div id="registro-content" class="modal-section">
                <!-- Popolato dinamicamente -->
            </div>
        </div>
    </div>

    <!-- MODALE ADMIN EDIT ORDINE -->
    <div id="admin-edit-modal" class="modal-overlay" onclick="kds.closeAdminEditModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">Modifica Ordine (Admin)</div>
                <button class="modal-close" onclick="kds.closeAdminEditModal()">√ó</button>
            </div>

            <div class="form-group">
                <label class="form-label">Articoli (uno per riga)</label>
                <textarea id="admin-edit-items" class="form-textarea" rows="8"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Note</label>
                <textarea id="admin-edit-notes" class="form-textarea" rows="3"></textarea>
            </div>

            <div class="form-buttons">
                <button class="btn-secondary" onclick="kds.closeAdminEditModal()">Annulla</button>
                <button class="btn-primary" onclick="kds.saveAdminEdit()">Salva Modifiche</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        /**
         * =====================================================================
         * KITCHEN DISPLAY SYSTEM - NEON EDITION (VERSIONE COMPLETA)
         * Sistema completo per gestione ordini ristorante
         * =====================================================================
         */

        const kds = {
            // Stato Applicazione
            state: {
                activeFilter: 'sala',
                orders: [],
                completedOrders: [], // Cronologia ordini completati
                currentTime: Date.now(),
                deliverooSeq: { char: 65, num: 201 },
                asportoSeq: 10,
                salaSeq: 100,
                adminMode: false,
                currentEditOrderId: null,
                deliveryTimers: {} // Timer per ordini consegnati
            },

            // Costanti Stati Ordine
            STATUS_FLOW: ['ordinato', 'preparazione', 'pronto', 'consegnato'],
            STATUS_LABELS: {
                'ordinato': 'Ordinato',
                'preparazione': 'In Preparazione',
                'pronto': 'Pronto',
                'consegnato': 'Consegnato'
            },
            SECTIONS: ['sala', 'deliveroo', 'asporto'],

            /**
             * Inizializzazione App
             */
            init() {
                // Pulisce localStorage per partire da zero
                this.clearAllData();
                this.initData();
                this.loadLastTab();
                this.render();
                this.startTimers();
                this.updateClock();
                this.initParticles();
                this.setupEventListeners();
            },

            /**
             * Pulisce tutti i dati salvati
             */
            clearAllData() {
                this.state.orders = [];
                this.state.completedOrders = [];
                localStorage.removeItem('kds-orders');
                localStorage.removeItem('kds-completed-orders');
            },

            /**
             * Setup event listeners aggiuntivi
             */
            setupEventListeners() {
                // Cambio canale nella modale aggiungi ordine
                const channelSelect = document.getElementById('new-order-channel');
                if (channelSelect) {
                    channelSelect.addEventListener('change', (e) => {
                        const tableGroup = document.getElementById('table-group');
                        if (e.target.value === 'sala') {
                            tableGroup.style.display = 'block';
                        } else {
                            tableGroup.style.display = 'none';
                        }
                    });
                }

                // Chiudi popup cliccando fuori
                document.addEventListener('click', (e) => {
                    const menuPopup = document.getElementById('popup-menu');
                    const quickPopup = document.getElementById('popup-quick-action');
                    const menuBtn = document.querySelector('.menu-btn');
                    const quickBtn = document.querySelector('.action-btn-main');

                    if (!menuBtn.contains(e.target) && !menuPopup.contains(e.target)) {
                        menuPopup.classList.remove('active');
                    }

                    if (!quickBtn.contains(e.target) && !quickPopup.contains(e.target)) {
                        quickPopup.classList.remove('active');
                    }
                });
            },

            /**
             * Inizializza dati (nessun ordine precreato)
             */
            initData() {
                // Non creare ordini di esempio, l'app parte vuota
                // Gli ordini vengono aggiunti manualmente dall'utente
            },

            /**
             * Genera codice Deliveroo sequenziale (#201, #202, ...)
             */
            generateDeliverooCode() {
                const num = this.state.deliverooSeq.num++;
                return `#${num}`;
            },

            /**
             * Salva stato in localStorage
             */
            saveToLocalStorage() {
                try {
                    localStorage.setItem('kds-orders', JSON.stringify(this.state.orders));
                    localStorage.setItem('kds-completed-orders', JSON.stringify(this.state.completedOrders));
                    localStorage.setItem('kds-sequences', JSON.stringify({
                        deliverooSeq: this.state.deliverooSeq,
                        asportoSeq: this.state.asportoSeq,
                        salaSeq: this.state.salaSeq
                    }));
                } catch (e) {
                    console.error('Errore salvataggio localStorage:', e);
                }
            },

            /**
             * Carica stato da localStorage
             */
            loadFromLocalStorage() {
                try {
                    const ordersData = localStorage.getItem('kds-orders');
                    const completedData = localStorage.getItem('kds-completed-orders');
                    const seqData = localStorage.getItem('kds-sequences');

                    if (ordersData) {
                        this.state.orders = JSON.parse(ordersData);
                    }
                    if (completedData) {
                        this.state.completedOrders = JSON.parse(completedData);
                    }
                    if (seqData) {
                        const seq = JSON.parse(seqData);
                        this.state.deliverooSeq = seq.deliverooSeq;
                        this.state.asportoSeq = seq.asportoSeq;
                        this.state.salaSeq = seq.salaSeq;
                    }
                } catch (e) {
                    console.error('Errore caricamento localStorage:', e);
                }
            },

            /**
             * Cambia filtro attivo e salva in localStorage
             */
            setFilter(type) {
                this.state.activeFilter = type;

                // Salva in localStorage
                localStorage.setItem('kds-last-tab', type);

                // Aggiorna UI tabs
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    const btnText = btn.innerText.toLowerCase();
                    const isActive = btnText === type;
                    btn.classList.toggle('active', isActive);
                    btn.setAttribute('aria-selected', isActive);
                });

                this.render();
            },

            /**
             * Carica ultimo tab salvato
             */
            loadLastTab() {
                const lastTab = localStorage.getItem('kds-last-tab');
                if (lastTab && this.SECTIONS.includes(lastTab)) {
                    this.setFilter(lastTab);
                }
            },

            /**
             * Naviga alla sezione precedente (freccia sinistra)
             */
            prevSection() {
                const currentIdx = this.SECTIONS.indexOf(this.state.activeFilter);
                const prevIdx = (currentIdx - 1 + this.SECTIONS.length) % this.SECTIONS.length;
                this.setFilter(this.SECTIONS[prevIdx]);
            },

            /**
             * Naviga alla sezione successiva (freccia destra)
             */
            nextSection() {
                const currentIdx = this.SECTIONS.indexOf(this.state.activeFilter);
                const nextIdx = (currentIdx + 1) % this.SECTIONS.length;
                this.setFilter(this.SECTIONS[nextIdx]);
            },

            /**
             * Avanza stato ordine al click
             */
            advanceStatus(orderId, event) {
                if (event) event.stopPropagation();

                const order = this.state.orders.find(o => o.id === orderId);
                if (!order) return;

                const currentIdx = this.STATUS_FLOW.indexOf(order.currentStatus);
                if (currentIdx < this.STATUS_FLOW.length - 1) {
                    const nextStatus = this.STATUS_FLOW[currentIdx + 1];
                    order.currentStatus = nextStatus;
                    order.timestamps[nextStatus] = Date.now();

                    // Se arriva a "consegnato", avvia timer 15s
                    if (nextStatus === 'consegnato') {
                        this.startDeliveryTimer(orderId);
                    }

                    this.saveToLocalStorage();
                    this.render();
                }
            },

            /**
             * Timer per rimozione ordine consegnato dopo 15 secondi
             */
            startDeliveryTimer(orderId) {
                // Cancella timer precedente se esiste
                if (this.state.deliveryTimers[orderId]) {
                    clearTimeout(this.state.deliveryTimers[orderId]);
                }

                // Avvia nuovo timer
                this.state.deliveryTimers[orderId] = setTimeout(() => {
                    this.archiveOrder(orderId);
                }, 15000); // 15 secondi
            },

            /**
             * Archivia ordine (sposta in completedOrders e rimuove da orders)
             */
            archiveOrder(orderId) {
                const orderIdx = this.state.orders.findIndex(o => o.id === orderId);
                if (orderIdx === -1) return;

                const order = this.state.orders[orderIdx];
                order.archivedAt = Date.now();

                // Aggiungi a cronologia
                this.state.completedOrders.unshift(order);

                // Rimuovi da ordini attivi
                this.state.orders.splice(orderIdx, 1);

                // Rimuovi timer
                delete this.state.deliveryTimers[orderId];

                this.saveToLocalStorage();
                this.render();
            },

            /**
             * Formatta timestamp assoluto (HH:MM)
             */
            formatTime(ts) {
                if (!ts) return "--:--";
                const d = new Date(ts);
                return d.getHours().toString().padStart(2, '0') + ":" +
                       d.getMinutes().toString().padStart(2, '0');
            },

            /**
             * Formatta tempo relativo (-MM:SS)
             */
            formatRelative(ts) {
                if (!ts) return "";
                const diff = Date.now() - ts;
                const totalSecs = Math.floor(diff / 1000);
                const mins = Math.floor(totalSecs / 60);
                const secs = totalSecs % 60;
                return `-${mins}:${secs.toString().padStart(2, '0')}`;
            },

            /**
             * Rendering completo interfaccia
             */
            render() {
                const filtered = this.state.orders.filter(o => o.type === this.state.activeFilter);
                const container = document.getElementById('orders-container');

                // Aggiorna contatore
                document.getElementById('count-display').innerText = filtered.length;

                // Se non ci sono ordini, mostra messaggio
                if (filtered.length === 0) {
                    container.innerHTML = '<div class="no-orders-message">Nessun ordine attivo</div>';
                    return;
                }

                // Renderizza card
                container.innerHTML = '';
                filtered.forEach((order, idx) => {
                    const html = this.buildUnifiedCard(order);
                    container.insertAdjacentHTML('beforeend', html);
                });
            },

            /**
             * Costruisce card unificata per tutte le sezioni
             */
            buildUnifiedCard(order) {
                const statusLabel = this.STATUS_LABELS[order.currentStatus];
                const isDelivered = order.currentStatus === 'consegnato';
                const adminClass = this.state.adminMode ? 'admin-mode' : '';

                // Contenuto centrale varia in base al tipo
                let centralContent = '';

                if (order.type === 'sala') {
                    centralContent = `
                        <div class="table-info">
                            <div class="table-number">Tavolo ${order.tableNumber}</div>
                            <div class="order-type-label">Sala</div>
                        </div>
                        <div class="order-code-display">${order.code}</div>
                    `;
                } else if (order.type === 'deliveroo') {
                    centralContent = `
                        <div class="table-info">
                            <div class="deliveroo-icon">üõµ</div>
                            <div class="order-type-label">Deliveroo</div>
                        </div>
                        <div class="order-code-display">${order.code}</div>
                    `;
                } else if (order.type === 'asporto') {
                    centralContent = `
                        <div class="table-info">
                            <div class="table-number">üì¶</div>
                            <div class="order-type-label">Asporto</div>
                        </div>
                        <div class="order-code-display">${order.code}</div>
                    `;
                }

                // Info aggiuntive
                const detailsContent = `
                    <div class="card-content">
                        <div class="detail-row">
                            <span class="detail-label">Orario Ordine</span>
                            <span class="detail-value">${this.formatTime(order.timestamps.ordinato)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Tempo Trascorso</span>
                            <span class="detail-value">${this.formatRelative(order.timestamps.ordinato)}</span>
                        </div>
                    </div>
                `;

                return `
                <div class="order-card ${adminClass}" onclick="kds.handleCardClick('${order.id}', event)">
                    <div class="status-badge status-badge--${order.currentStatus}"
                         onclick="kds.advanceStatus('${order.id}', event)"
                         ${isDelivered ? 'style="cursor:default; pointer-events:none;"' : ''}>
                        <span class="status-led"></span>
                        ${statusLabel}
                    </div>

                    <div class="card-header">
                        ${centralContent}
                    </div>

                    ${detailsContent}
                </div>
                `;
            },

            /**
             * Gestisce click sulla card (dettaglio o admin edit)
             */
            handleCardClick(orderId, event) {
                if (event) event.stopPropagation();

                if (this.state.adminMode) {
                    this.openAdminEditModal(orderId);
                } else {
                    this.openOrderDetail(orderId);
                }
            },

            /**
             * Apri dettaglio ordine
             */
            openOrderDetail(orderId) {
                const order = this.state.orders.find(o => o.id === orderId);
                if (!order) return;

                // Popola modale
                document.getElementById('modal-title').innerText = `Dettaglio Ordine ${order.code}`;
                document.getElementById('modal-order-code').innerText = order.code;
                document.getElementById('modal-order-type').innerText = order.type.toUpperCase();
                document.getElementById('modal-order-status').innerText = this.STATUS_LABELS[order.currentStatus];
                document.getElementById('modal-order-time').innerText = this.formatTime(order.timestamps.ordinato);
                document.getElementById('modal-order-elapsed').innerText = this.formatRelative(order.timestamps.ordinato);

                // Popola lista articoli
                const itemsContainer = document.getElementById('modal-items');
                itemsContainer.innerHTML = '';

                if (order.items && order.items.length > 0) {
                    order.items.forEach(item => {
                        const itemHTML = `
                            <div class="item-row">
                                <div>
                                    <div class="item-name">${item.name}</div>
                                    ${item.note ? `<div class="item-note">${item.note}</div>` : ''}
                                </div>
                                <div class="item-qty">x${item.qty}</div>
                            </div>
                        `;
                        itemsContainer.insertAdjacentHTML('beforeend', itemHTML);
                    });
                } else {
                    itemsContainer.innerHTML = '<div class="item-note">Nessun articolo specificato</div>';
                }

                // Mostra modale
                document.getElementById('modal-order-detail').classList.add('active');
            },

            /**
             * Chiudi modale dettaglio
             */
            closeModal(event) {
                if (event && event.target !== event.currentTarget && !event.target.classList.contains('modal-close')) {
                    return;
                }
                document.getElementById('modal-order-detail').classList.remove('active');
            },

            /**
             * Toggle menu popup
             */
            toggleMenu() {
                const popup = document.getElementById('popup-menu');
                const quickPopup = document.getElementById('popup-quick-action');
                quickPopup.classList.remove('active');
                popup.classList.toggle('active');
            },

            /**
             * Toggle Quick Action popup
             */
            toggleQuickAction() {
                const popup = document.getElementById('popup-quick-action');
                const menuPopup = document.getElementById('popup-menu');
                menuPopup.classList.remove('active');
                popup.classList.toggle('active');
            },

            /**
             * Apri Registro Ordini (cronologia)
             */
            openRegistroOrdini() {
                document.getElementById('popup-menu').classList.remove('active');

                const registroContent = document.getElementById('registro-content');
                registroContent.innerHTML = '';

                if (this.state.completedOrders.length === 0) {
                    registroContent.innerHTML = '<div class="no-orders-message">Nessun ordine completato</div>';
                } else {
                    this.state.completedOrders.forEach((order, index) => {
                        // Genera HTML per articoli
                        let itemsHTML = '';
                        if (order.items && order.items.length > 0) {
                            order.items.forEach(item => {
                                itemsHTML += `
                                    <div class="item-row">
                                        <div>
                                            <div class="item-name">${item.name}</div>
                                            ${item.note ? `<div class="item-note">${item.note}</div>` : ''}
                                        </div>
                                        <div class="item-qty">x${item.qty}</div>
                                    </div>
                                `;
                            });
                        } else {
                            itemsHTML = '<div class="item-note">Nessun articolo specificato</div>';
                        }

                        const orderHTML = `
                            <div class="registro-order-item" onclick="kds.toggleRegistroDetails(${index})">
                                <div class="registro-order-header">
                                    <span class="registro-order-code">${order.code}</span>
                                    <span class="registro-order-time">${this.formatTime(order.archivedAt)}</span>
                                </div>
                                <div class="registro-order-info">
                                    ${order.type.toUpperCase()}${order.tableNumber ? ' - Tavolo ' + order.tableNumber : ''}
                                </div>
                                <div class="registro-order-details" id="registro-details-${index}">
                                    <div class="registro-items-title">Articoli Ordinati</div>
                                    <div class="items-list">
                                        ${itemsHTML}
                                    </div>
                                </div>
                            </div>
                        `;
                        registroContent.insertAdjacentHTML('beforeend', orderHTML);
                    });
                }

                document.getElementById('registro-modal').classList.add('active');
            },

            /**
             * Toggle dettagli ordine nel registro
             */
            toggleRegistroDetails(index) {
                const detailsEl = document.getElementById(`registro-details-${index}`);
                if (detailsEl) {
                    detailsEl.classList.toggle('expanded');
                }
            },

            /**
             * Chiudi Registro Modal
             */
            closeRegistroModal(event) {
                if (event && event.target !== event.currentTarget && !event.target.classList.contains('modal-close')) {
                    return;
                }
                document.getElementById('registro-modal').classList.remove('active');
            },

            /**
             * Toggle Admin Mode
             */
            toggleAdminMode() {
                this.state.adminMode = !this.state.adminMode;
                document.getElementById('popup-menu').classList.remove('active');
                this.render();

                if (this.state.adminMode) {
                    alert('Modalit√† Admin attivata: clicca su una card per modificare gli articoli.');
                } else {
                    alert('Modalit√† Admin disattivata.');
                }
            },

            /**
             * Apri modale Admin Edit
             */
            openAdminEditModal(orderId) {
                const order = this.state.orders.find(o => o.id === orderId);
                if (!order) return;

                this.state.currentEditOrderId = orderId;

                // Popola textarea con articoli
                const itemsText = order.items.map(item => {
                    return `${item.name} x${item.qty}${item.note ? ' - ' + item.note : ''}`;
                }).join('\n');

                document.getElementById('admin-edit-items').value = itemsText;
                document.getElementById('admin-edit-notes').value = order.adminNotes || '';

                document.getElementById('admin-edit-modal').classList.add('active');
            },

            /**
             * Chiudi Admin Edit Modal
             */
            closeAdminEditModal(event) {
                if (event && event.target !== event.currentTarget && !event.target.classList.contains('modal-close')) {
                    return;
                }
                document.getElementById('admin-edit-modal').classList.remove('active');
                this.state.currentEditOrderId = null;
            },

            /**
             * Salva modifiche Admin
             */
            saveAdminEdit() {
                if (!this.state.currentEditOrderId) return;

                const order = this.state.orders.find(o => o.id === this.state.currentEditOrderId);
                if (!order) return;

                const itemsText = document.getElementById('admin-edit-items').value;
                const notesText = document.getElementById('admin-edit-notes').value;

                // Parse articoli
                const lines = itemsText.split('\n').filter(l => l.trim());
                const newItems = lines.map(line => {
                    const match = line.match(/^(.+?)\s+x(\d+)(?:\s+-\s+(.+))?$/);
                    if (match) {
                        return {
                            name: match[1].trim(),
                            qty: parseInt(match[2]),
                            note: match[3] ? match[3].trim() : ''
                        };
                    }
                    return { name: line.trim(), qty: 1, note: '' };
                });

                order.items = newItems;
                order.adminNotes = notesText;

                this.saveToLocalStorage();
                this.closeAdminEditModal();
                this.render();
            },

            /**
             * Quick Action: cambia stato a tutti gli ordini della sezione corrente
             */
            quickAction(targetStatus) {
                document.getElementById('popup-quick-action').classList.remove('active');

                const filtered = this.state.orders.filter(o => o.type === this.state.activeFilter);

                filtered.forEach(order => {
                    const targetIdx = this.STATUS_FLOW.indexOf(targetStatus);
                    const currentIdx = this.STATUS_FLOW.indexOf(order.currentStatus);

                    if (targetIdx > currentIdx) {
                        order.currentStatus = targetStatus;
                        order.timestamps[targetStatus] = Date.now();

                        // Se diventa consegnato, avvia timer
                        if (targetStatus === 'consegnato') {
                            this.startDeliveryTimer(order.id);
                        }
                    }
                });

                this.saveToLocalStorage();
                this.render();
            },

            /**
             * Apri modale aggiungi ordine
             */
            openAddOrderModal() {
                document.getElementById('add-order-modal').classList.add('active');
                document.getElementById('new-order-channel').value = this.state.activeFilter;
                document.getElementById('table-group').style.display =
                    this.state.activeFilter === 'sala' ? 'block' : 'none';

                // Reset campi
                document.getElementById('new-order-table').value = '';
                document.getElementById('new-order-items').value = '';
                document.getElementById('new-order-notes').value = '';
            },

            /**
             * Chiudi modale aggiungi ordine
             */
            closeAddOrderModal() {
                document.getElementById('add-order-modal').classList.remove('active');
            },

            /**
             * Crea nuovo ordine
             */
            createNewOrder() {
                const channel = document.getElementById('new-order-channel').value;
                const table = document.getElementById('new-order-table').value;
                const itemsText = document.getElementById('new-order-items').value;
                const notesText = document.getElementById('new-order-notes').value;

                // Validazione
                if (channel === 'sala' && !table) {
                    alert('Inserisci il numero del tavolo');
                    return;
                }

                if (!itemsText.trim()) {
                    alert('Inserisci almeno un articolo');
                    return;
                }

                // Parse articoli
                const lines = itemsText.split('\n').filter(l => l.trim());
                const items = lines.map(line => {
                    const match = line.match(/^(.+?)\s+x(\d+)$/);
                    if (match) {
                        return {
                            name: match[1].trim(),
                            qty: parseInt(match[2]),
                            note: ''
                        };
                    }
                    return { name: line.trim(), qty: 1, note: '' };
                });

                // Genera codice ordine
                let code = '';
                if (channel === 'sala') {
                    code = `#${this.state.salaSeq++}`;
                } else if (channel === 'asporto') {
                    code = `#P${this.state.asportoSeq++}`;
                } else {
                    code = this.generateDeliverooCode();
                }

                // Crea ordine
                const newOrder = {
                    id: Math.random().toString(36).substr(2, 9),
                    type: channel,
                    tableNumber: channel === 'sala' ? parseInt(table) : null,
                    code: code,
                    currentStatus: 'ordinato',
                    timestamps: {
                        ordinato: Date.now(),
                        preparazione: null,
                        pronto: null,
                        consegnato: null
                    },
                    items: items,
                    adminNotes: notesText
                };

                this.state.orders.push(newOrder);
                this.saveToLocalStorage();
                this.closeAddOrderModal();
                this.setFilter(channel); // Vai alla sezione dell'ordine creato
                this.render();
            },

            /**
             * Gestione Timer
             */
            startTimers() {
                // Aggiorna orologio ogni secondo
                setInterval(() => this.updateClock(), 1000);

                // Aggiorna tempi relativi ogni 5 secondi
                setInterval(() => this.render(), 5000);
            },

            updateClock() {
                const now = new Date();
                const timeStr = now.getHours().toString().padStart(2, '0') + ':' +
                              now.getMinutes().toString().padStart(2, '0');
                document.getElementById('clock-display').innerText = timeStr;
            },

            /**
             * Particle System Canvas
             */
            initParticles() {
                const canvas = document.getElementById('particles');
                const ctx = canvas.getContext('2d');

                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                const particles = [];
                const particleCount = 80;

                // Crea particelle
                for (let i = 0; i < particleCount; i++) {
                    particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        size: Math.random() * 2 + 0.5,
                        speedX: (Math.random() - 0.5) * 0.5,
                        speedY: (Math.random() - 0.5) * 0.5,
                        color: Math.random() > 0.5 ? '#00E5FF' : '#FF00FF'
                    });
                }

                // Animazione
                function animate() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    particles.forEach(p => {
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                        ctx.fillStyle = p.color;
                        ctx.shadowBlur = 10;
                        ctx.shadowColor = p.color;
                        ctx.fill();

                        // Movimento
                        p.x += p.speedX;
                        p.y += p.speedY;

                        // Rimbalzo bordi
                        if (p.x < 0 || p.x > canvas.width) p.speedX *= -1;
                        if (p.y < 0 || p.y > canvas.height) p.speedY *= -1;
                    });

                    requestAnimationFrame(animate);
                }

                animate();

                // Resize handler
                window.addEventListener('resize', () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                });
            }
        };

        // Avvio applicazione
        document.addEventListener('DOMContentLoaded', () => kds.init());
    </script>
</body>
</html>

    </template>

    <script>
        // ... (CODICE PARTICELLE, METEO, PLAYER - TUTTO INVARIATO) ...
        // INSERISCI QUI IL CODICE JS STANDARD DELLE VERSIONI PRECEDENTI PER BACKGROUND E PLAYER

        // ... (CODICE JS HUB UNIFICATO) ...
        const canvas = document.getElementById('living-bg'); const ctx = canvas.getContext('2d'); let width, height; let particles = []; const mouse = { x: -1000, y: -1000 };
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; } window.addEventListener('resize', resize); resize();
        class Particle { constructor() { this.x = Math.random() * width; this.y = Math.random() * height; this.baseX = this.x; this.baseY = this.y; this.size = Math.random() * 2 + 0.5; this.color = `rgba(${100 + Math.random()*155}, ${200 + Math.random()*55}, 255, ${Math.random()*0.3 + 0.1})`; this.angle = Math.random() * Math.PI * 2; this.speed = Math.random() * 0.3 + 0.1; } update(time) { this.x += Math.cos(this.angle + time * 0.001) * this.speed; this.y += Math.sin(this.angle + time * 0.001) * this.speed; const dx = mouse.x - this.x; const dy = mouse.y - this.y; const distance = Math.sqrt(dx * dx + dy * dy); if (distance < 250) { const force = (250 - distance) / 250; this.x += (dx / distance) * force * -4; this.y += (dy / distance) * force * -4; } if (this.x < 0) this.x = width; if (this.x > width) this.x = 0; if (this.y < 0) this.y = height; if (this.y > height) this.y = 0; } draw() { ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fillStyle = this.color; ctx.fill(); } }
        function initParticles() { particles = []; for (let i = 0; i < 150; i++) particles.push(new Particle()); } let time = 0; function animateParticles() { ctx.clearRect(0, 0, width, height); time++; particles.forEach(p => { p.update(time); p.draw(); }); requestAnimationFrame(animateParticles); } initParticles(); animateParticles();
        document.addEventListener('mousemove', (e) => { const x = e.clientX; const y = e.clientY; document.documentElement.style.setProperty('--mouse-x', x + 'px'); document.documentElement.style.setProperty('--mouse-y', y + 'px'); mouse.x = x; mouse.y = y; document.querySelectorAll('.interactive-glass').forEach(el => { const rect = el.getBoundingClientRect(); el.style.setProperty('--rx', (x - rect.left) + 'px'); el.style.setProperty('--ry', (y - rect.top) + 'px'); }); });
        
        function applyTiltLogic() { document.querySelectorAll('.hub-tile').forEach(card => { card.addEventListener('mousemove', (e) => { const rect = card.getBoundingClientRect(); const centerX = rect.width / 2; const centerY = rect.height / 2; const rotateX = ((e.clientY - rect.top - centerY) / 20) * -1; const rotateY = (e.clientX - rect.left - centerX) / 20; card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`; }); card.addEventListener('mouseenter', () => { const color = card.style.getPropertyValue('--neon-color'); if(color) { document.documentElement.style.setProperty('--active-color', color); document.documentElement.style.setProperty('--spot-size', '600px'); } }); card.addEventListener('mouseleave', () => { card.style.transform = `perspective(1000px) rotateX(0) rotateY(0) scale(1)`; document.documentElement.style.setProperty('--active-color', 'rgba(255,255,255,0.2)'); document.documentElement.style.setProperty('--spot-size', '400px'); }); }); }
        function updateClock() { const now = new Date(); document.getElementById('clock').innerText = now.toLocaleTimeString('it-IT', {hour:'2-digit', minute:'2-digit'}); document.getElementById('date').innerText = now.toLocaleDateString('it-IT', {weekday:'short', day:'numeric', month:'short'}).toUpperCase(); } setInterval(updateClock, 1000); updateClock();

        const APP_REGISTRY = [
            { id: 'app-a', label: 'Gestione<br>Sala', subtitle: 'Tavoli e comande', iconColor: '#54a0ff', iconSvg: `<svg viewBox="0 0 240 160"><g transform="translate(-14, -10) scale(1.12)" class="neon-icon-glow"><rect x="80" y="62" width="80" height="8" rx="4" fill="#aaddff" /><line x1="120" y1="70" x2="120" y2="115" stroke="white" stroke-width="5" /><path d="M95 125 Q120 105 145 125" stroke="white" stroke-width="4" fill="none" stroke-linecap="round"/><g transform="translate(60, 60)"><path d="M4 0 L4 30 Q4 35 9 35" fill="none" stroke="url(#iconGradA)" stroke-width="10" stroke-linecap="round" transform="rotate(-12)"/><rect x="10" y="36" width="32" height="8" rx="3" fill="white" /><line x1="15" y1="44" x2="15" y2="75" stroke="white" stroke-width="3" transform="rotate(8 15 44)"/><line x1="35" y1="44" x2="44" y2="75" stroke="white" stroke-width="3" transform="rotate(4 35 44)"/></g><g transform="translate(180, 60) scale(-1, 1)"><path d="M4 0 L4 30 Q4 35 9 35" fill="none" stroke="url(#iconGradA)" stroke-width="10" stroke-linecap="round" transform="rotate(-12)"/><rect x="10" y="36" width="32" height="8" rx="3" fill="white" /><line x1="15" y1="44" x2="15" y2="75" stroke="white" stroke-width="3" transform="rotate(8 15 44)"/><line x1="35" y1="44" x2="44" y2="75" stroke="white" stroke-width="3" transform="rotate(4 35 44)"/></g><g class="place-setting-plate"><ellipse cx="95" cy="58" rx="7" ry="2.5" fill="#fff" filter="drop-shadow(0 0 2px #fff)"/><ellipse cx="145" cy="58" rx="7" ry="2.5" fill="#fff" filter="drop-shadow(0 0 2px #fff)"/></g><g class="hologram-anchor" transform="translate(120, 62)"><g class="hologram-anim-layer"><path class="hologram-beam" d="M0 0 L-20 -45 L20 -45 Z" /><rect x="-25" y="-45" width="50" height="18" rx="4" class="hologram-border" fill="rgba(0,0,0,0.8)" /><text x="0" y="-32" text-anchor="middle" class="hologram-text">NOVIT√Ä</text></g></g></g></svg>` },
            { id: 'app-b', label: 'Tothem<br>Self', subtitle: 'Ordini self-service', iconColor: '#00d2d3', iconSvg: `<svg viewBox="0 0 160 200"><g transform="translate(-20, -18) scale(1.32)" class="neon-icon-glow"><rect x="55" y="20" width="50" height="140" rx="6" fill="white" /><rect x="45" y="160" width="70" height="6" rx="3" fill="white" /><rect x="58" y="28" width="44" height="64" rx="4" fill="black" /><rect class="totem-screen-fill" x="61" y="31" width="38" height="58" rx="2" fill="#00d2d3" /><rect x="65" y="115" width="30" height="4" rx="2" fill="#333" /><image class="hand-cursor" href="https://static.vecteezy.com/system/resources/previews/021/996/826/non_2x/hand-cursor-icon-clip-art-free-png.png" x="84" y="65" width="55" height="55" filter="url(#handGlow)"/></g></svg>` },
            { id: 'app-c', label: 'Kitchen<br>Monitor', subtitle: 'Monitor cucina e tempi', iconColor: '#8e44ad', iconSvg: `<svg viewBox="0 0 240 200"><g transform="translate(120, 170)" opacity="0.8"><ellipse cx="0" cy="0" rx="132" ry="33" fill="none" stroke="#a29bfe" stroke-width="1.5" opacity="0.15"/></g><g transform="translate(120, 76) scale(1.22)"><g transform="translate(-100, -60)" class="neon-icon-glow"><path d="M 90 105 L 85 127 L 115 127 L 110 105 Z" fill="#5f27cd" /><rect x="70" y="132" width="60" height="10" rx="5" fill="#5f27cd" /><rect x="10" y="0" width="180" height="105" rx="8" fill="url(#frameGrad)" /><rect x="18" y="8" width="164" height="89" rx="3" fill="white" /><g transform="translate(100, 52) scale(1.35)"><g transform="translate(-22, 2)" stroke="#341f97" stroke-width="2.2" stroke-linecap="round" fill="none"><path d="M-10 0 C-10 8 -4 12 0 12 C4 12 10 8 10 0 L10 -4 L-10 -4 Z" /><path d="M10 -2 C14 -2 14 6 10 6" /><g transform="translate(0, -12)"><path class="steam-path steam-1" d="M-5 0 L-5 -5" /><path class="steam-path steam-2" d="M0 0 L0 -7" /><path class="steam-path steam-3" d="M5 0 L5 -5" /></g></g><g transform="translate(22, 5) scale(1.12)" stroke="#341f97" stroke-width="1.96" fill="none"><circle cx="0" cy="0" r="9" /><line class="clock-hand" x1="0" y1="0" x2="0" y2="-5" stroke-linecap="round" /></g></g></g></g></svg>` }
        ];

        function renderHomeTiles() {
            const homeContainer = document.getElementById('hub-home'); homeContainer.innerHTML = '';
            APP_REGISTRY.forEach(app => {
                const tile = document.createElement('div'); tile.className = 'hub-tile interactive-glass'; tile.onclick = () => openApp(app.id); tile.setAttribute('data-app-id', app.id); tile.style.setProperty('--tile-color', app.iconColor); tile.style.setProperty('--neon-color', app.iconColor); 
                tile.innerHTML = `<div class="hub-tile-content"><div class="hub-tile-title">${app.label}</div><div class="hub-tile-icon"><div class="hub-tile-glow"></div>${app.iconSvg}</div><div class="hub-tile-footer">${app.subtitle}</div></div>`;
                homeContainer.appendChild(tile);
            });
            applyTiltLogic();
        }

        // PLAYER LOGIC (OMESSA PER BREVIT√Ä - COPIA DAL PRECEDENTE)

        // VAR GLOBALE PER TRACCIARE L'APP APERTA
        let currentAppId = null;

        /* FULLSCREEN APP NAV LOGIC */
        function openApp(appId) {
            currentAppId = appId;
            const template = document.getElementById(appId); if (!template) return;
            const appView = document.getElementById('hub-app-view');
            const iframe = document.getElementById('hub-iframe');
            
            appView.classList.add('active');
            iframe.srcdoc = template.innerHTML;
        }

        /* LOGICA DI CHIUSURA CON PASSWORD PER IL TOTEM */
        function attemptClose() {
            if (currentAppId === 'app-b') { // Se √® il TOTEM SELF
                const pass = prompt("Inserisci PIN Amministratore per uscire:");
                if (pass === "0000") {
                    closeApp();
                } else {
                    if (pass !== null) alert("PIN Errato!");
                }
            } else {
                // Per le altre app, chiudi direttamente
                closeApp();
            }
        }

        function closeApp() {
            const appView = document.getElementById('hub-app-view');
            const iframe = document.getElementById('hub-iframe');
            currentAppId = null;
            
            appView.classList.remove('active');
            setTimeout(() => { iframe.srcdoc = ""; }, 300);
        }

        document.addEventListener('DOMContentLoaded', () => { renderHomeTiles(); });
    </script>
</body>
</html>
